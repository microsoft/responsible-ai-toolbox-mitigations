<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Case Study 2 &mdash; RAI Error Mitigation  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Case Study 3" href="case3.html" />
    <link rel="prev" title="Case Study 1" href="case1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> RAI Error Mitigation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../databalanceanalysis/databalanceanalysis.html">databalanceanalysis</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../intro.html">dataprocessing</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../intro.html#target-audience">Target Audience</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../intro.html#structure">Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../intro.html#api">API</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../intro.html#examples">Examples</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../../case_studies.html">Case Studies</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../../case_studies.html#utilities">Utilities</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../../case_studies.html#notebooks">Notebooks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../module_tests.html">Tutorials</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../intro.html#sklearn-s-pipeline-support">Sklearn’s Pipeline Support</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">RAI Error Mitigation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../intro.html">dataprocessing</a> &raquo;</li>
          <li><a href="../../case_studies.html">Case Studies</a> &raquo;</li>
      <li>Case Study 2</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com//microsoft/responsible-ai-toolbox-mitigations/blob/main/docs/dataprocessing/notebooks/case_study/case2.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">uci_dataset</span> <span class="k">as</span> <span class="nn">database</span>

<span class="kn">import</span> <span class="nn">raimitigations.dataprocessing</span> <span class="k">as</span> <span class="nn">dp</span>
</pre></div>
</div>
</div>
<section id="Case-Study-2">
<h1>Case Study 2<a class="headerlink" href="#Case-Study-2" title="Permalink to this heading"></a></h1>
<section id="1---Understanding-the-Data">
<h2>1 - Understanding the Data<a class="headerlink" href="#1---Understanding-the-Data" title="Permalink to this heading"></a></h2>
<p>In this example, we will build a classifier to detect diseased trees using the <code class="docutils literal notranslate"><span class="pre">dataprocessing</span></code> library, with data from the <code class="docutils literal notranslate"><span class="pre">uci_dataset</span></code>. The data itself comes from spectral imagery, and the data columns relate to features in the imagery.</p>
<p>The data columns have the following meaning: - class: ‘w’ (diseased trees), ‘n’ (all other land cover) - GLCM_Pan: GLCM mean texture (Pan band) - Mean_G: Mean green value - Mean_R: Mean red value - Mean_NIR: Mean NIR value - SD_Pan: Standard deviation (Pan band)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">load_wilt</span><span class="p">()</span>
<span class="n">label_col</span> <span class="o">=</span> <span class="s2">&quot;class&quot;</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>class</th>
      <th>GLCM_pan</th>
      <th>Mean_Green</th>
      <th>Mean_Red</th>
      <th>Mean_NIR</th>
      <th>SD_pan</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>w</td>
      <td>120.362774</td>
      <td>205.500000</td>
      <td>119.395349</td>
      <td>416.581395</td>
      <td>20.676318</td>
    </tr>
    <tr>
      <th>1</th>
      <td>w</td>
      <td>124.739583</td>
      <td>202.800000</td>
      <td>115.333333</td>
      <td>354.333333</td>
      <td>16.707151</td>
    </tr>
    <tr>
      <th>2</th>
      <td>w</td>
      <td>134.691964</td>
      <td>199.285714</td>
      <td>116.857143</td>
      <td>477.857143</td>
      <td>22.496712</td>
    </tr>
    <tr>
      <th>3</th>
      <td>w</td>
      <td>127.946309</td>
      <td>178.368421</td>
      <td>92.368421</td>
      <td>278.473684</td>
      <td>14.977453</td>
    </tr>
    <tr>
      <th>4</th>
      <td>w</td>
      <td>135.431548</td>
      <td>197.000000</td>
      <td>112.690476</td>
      <td>532.952381</td>
      <td>17.604193</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>495</th>
      <td>n</td>
      <td>123.554348</td>
      <td>202.826087</td>
      <td>106.391304</td>
      <td>364.565217</td>
      <td>17.314068</td>
    </tr>
    <tr>
      <th>496</th>
      <td>n</td>
      <td>121.549028</td>
      <td>276.220000</td>
      <td>175.593333</td>
      <td>402.620000</td>
      <td>13.394574</td>
    </tr>
    <tr>
      <th>497</th>
      <td>n</td>
      <td>119.076687</td>
      <td>247.951220</td>
      <td>113.365854</td>
      <td>808.024390</td>
      <td>24.830059</td>
    </tr>
    <tr>
      <th>498</th>
      <td>n</td>
      <td>107.944444</td>
      <td>197.000000</td>
      <td>90.000000</td>
      <td>451.000000</td>
      <td>8.214887</td>
    </tr>
    <tr>
      <th>499</th>
      <td>n</td>
      <td>119.731928</td>
      <td>182.238095</td>
      <td>74.285714</td>
      <td>301.690476</td>
      <td>22.944278</td>
    </tr>
  </tbody>
</table>
<p>4839 rows × 6 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s2">&quot;w&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 4839 entries, 0 to 499
Data columns (total 6 columns):
 #   Column      Non-Null Count  Dtype
---  ------      --------------  -----
 0   class       4839 non-null   int64
 1   GLCM_pan    4839 non-null   float64
 2   Mean_Green  4839 non-null   float64
 3   Mean_Red    4839 non-null   float64
 4   Mean_NIR    4839 non-null   float64
 5   SD_pan      4839 non-null   float64
dtypes: float64(5), int64(1)
memory usage: 264.6 KB
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
class         False
GLCM_pan      False
Mean_Green    False
Mean_Red      False
Mean_NIR      False
SD_pan        False
dtype: bool
</pre></div></div>
</div>
<p>First, we will try to determine if any of the features are correlated, and remove the correlated features.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cor_feat</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">CorrelatedFeatures</span><span class="p">(</span>
                                    <span class="n">method_num_num</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;spearman&quot;</span><span class="p">,</span> <span class="s2">&quot;pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;kendall&quot;</span><span class="p">],</span>                              <span class="c1"># Used for Numerical x Numerical correlations</span>
                                    <span class="n">num_corr_th</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>                                                                                                <span class="c1"># Used for Numerical x Numerical correlations</span>
                                    <span class="n">num_pvalue_th</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>                                                                                             <span class="c1"># Used for Numerical x Numerical correlations</span>
                                    <span class="n">method_num_cat</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span>                                                                                 <span class="c1"># Used for Numerical x Categorical correlations</span>
                                    <span class="n">model_metrics</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="s2">&quot;auc&quot;</span><span class="p">],</span>                                                                    <span class="c1"># Used for Numerical x Categorical correlations</span>
                                    <span class="n">metric_th</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>                                                                                                  <span class="c1"># Used for Numerical x Categorical correlations</span>
                                    <span class="n">cat_corr_th</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>                                                                                                <span class="c1"># Used for Categorical x Categorical correlations</span>
                                    <span class="n">cat_pvalue_th</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>                                                                                             <span class="c1"># Used for Categorical x Categorical correlations</span>
                                    <span class="n">json_summary</span><span class="o">=</span><span class="s2">&quot;./corr_json/c2_summary.json&quot;</span><span class="p">,</span>
                                    <span class="n">json_corr</span><span class="o">=</span><span class="s2">&quot;./corr_json/c2_corr.json&quot;</span><span class="p">,</span>
                                    <span class="n">json_uncorr</span><span class="o">=</span><span class="s2">&quot;./corr_json/c2_uncorr.json&quot;</span>
                            <span class="p">)</span>
<span class="n">cor_feat</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">label_col</span><span class="o">=</span><span class="n">label_col</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
No correlations detected. Nothing to be done here.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;raimitigations.dataprocessing.feat_selection.correlated_features.CorrelatedFeatures at 0x2759e35b940&gt;
</pre></div></div>
</div>
<p>Remember to look through the JSON files generated in the previous cell. But, according to the thresholds we have set, no features are correlated.</p>
</section>
<section id="2---Baseline-Models">
<h2>2 - Baseline Models<a class="headerlink" href="#2---Baseline-Models" title="Permalink to this heading"></a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    4578
1     261
Name: class, dtype: int64
</pre></div></div>
</div>
<p>In this example, we have an imbalanced dataset (most trees are not diseased). While we will take a look at a number of different metrics, we will be focused on improved the F1 score for this dataset.</p>
<p>After splitting the data into train and test sets, we will build two baseline models, one with XGBoost, and the other with KNN.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_x</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_y</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">split_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">label_col</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;xgb&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------
TEST
------------
[[1100   45]
 [   3   62]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_12_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_12_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 96.03%

Precision:  0.7883596986976893

Recall:  0.957272421901243

F1 =  0.8497889596954399

ROC AUC =  0.9898958683238159
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------
TEST
------------
[[1100   45]
 [   8   57]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_13_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_13_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 95.62%

Precision:  0.7758016564026333

Recall:  0.9188108834397044

F1 =  0.829555270284996

ROC AUC =  0.9331877729257643
</pre></div></div>
</div>
<p>For a baseline, XGBoost and KNN have F1 scores around 0.86 (this will depend on your train/test split if you rerun this notebook). We will now proceed to try and improve on these results.</p>
</section>
<section id="3---Data-Transformation">
<h2>3 - Data Transformation<a class="headerlink" href="#3---Data-Transformation" title="Permalink to this heading"></a></h2>
<section id="DataMinMaxScaler">
<h3>DataMinMaxScaler<a class="headerlink" href="#DataMinMaxScaler" title="Permalink to this heading"></a></h3>
<p>The first data transformation we will perform is a MinMaxScaler, which will scale each feature to have a range between zero and one. This does not improve the results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">DataMinMaxScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">train_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">test_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x_scl</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x_scl</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------
TEST
------------
[[1003  142]
 [  15   50]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_18_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_18_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 87.02%

Precision:  0.6228409462999345

Recall:  0.8226066509909304

F1 =  0.6582603424052558

ROC AUC =  0.8433053409472623
</pre></div></div>
</div>
</section>
<section id="DataNormalizer">
<h3>DataNormalizer<a class="headerlink" href="#DataNormalizer" title="Permalink to this heading"></a></h3>
<p>Next we try <code class="docutils literal notranslate"><span class="pre">DataNormalizer</span></code>, which will scale the vectors to have unit norm (i.e. vector of length one). This is often used in text classification, but we will use it here as well. But it does not improve the results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">DataNormalizer</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">train_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">test_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x_scl</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x_scl</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
No columns specified for imputation. These columns have been automatically identified:
[]
------------
TEST
------------
[[1100   45]
 [   5   60]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_21_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_21_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 95.87%

Precision:  0.7834518422753717

Recall:  0.9418878065166275

F1 =  0.8418300653594771

ROC AUC =  0.9543836076587169
</pre></div></div>
</div>
</section>
<section id="DataStandardScaler">
<h3>DataStandardScaler<a class="headerlink" href="#DataStandardScaler" title="Permalink to this heading"></a></h3>
<p>The standard scaler sets the mean to zero and scales the vectors to have unit variance.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">DataStandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">train_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">test_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x_scl</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x_scl</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------
TEST
------------
[[1076   69]
 [  11   54]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_24_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_24_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 93.39%

Precision:  0.7144523975138556

Recall:  0.8852536110178032

F1 =  0.7693128955997866

ROC AUC =  0.9034329862277461
</pre></div></div>
</div>
</section>
<section id="DataQuantileTransformer">
<h3>DataQuantileTransformer<a class="headerlink" href="#DataQuantileTransformer" title="Permalink to this heading"></a></h3>
<p>The Quantile Transformer transforms the each feature to have a normal distribution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">DataQuantileTransformer</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">train_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">test_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x_scl</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x_scl</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------
TEST
------------
[[1094   51]
 [   5   60]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_26_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_26_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 95.37%

Precision:  0.7679954750018445

Recall:  0.939267719180383

F1 =  0.8284313725490196

ROC AUC =  0.955115888478334
</pre></div></div>
</div>
<p>As we can see, this transformation had some impact in the results (depends on the seed used) when we use KNN. Let’s check how this data transformation impacts the XGBoost model:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x_scl</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x_scl</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;xgb&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------
TEST
------------
[[1100   45]
 [   3   62]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_28_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_28_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 96.03%

Precision:  0.7883596986976893

Recall:  0.957272421901243

F1 =  0.8497889596954399

ROC AUC =  0.9899361773597581
</pre></div></div>
</div>
<p>As depicted above, the results for the XGBoost remains the same as before. This shows us that data transformations are more impactful in certain models and less meaningful in others.</p>
</section>
<section id="DataRobustScaler">
<h3>DataRobustScaler<a class="headerlink" href="#DataRobustScaler" title="Permalink to this heading"></a></h3>
<p>The robust scaler centers the data (median=zero) and scales the data based on the interquartile range (IQR).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">DataRobustScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">train_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">test_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x_scl</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x_scl</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------
TEST
------------
[[1105   40]
 [   5   60]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_31_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_31_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 96.28%

Precision:  0.7977477477477477

Recall:  0.9440712126301647

F1 =  0.853658536585366

ROC AUC =  0.9577426939872354
</pre></div></div>
</div>
</section>
<section id="DataPowerTransformer">
<h3>DataPowerTransformer<a class="headerlink" href="#DataPowerTransformer" title="Permalink to this heading"></a></h3>
<p>The power transformer makes the data more Gaussian-like (by default using the Yeo-Johnson transform).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaler</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">DataPowerTransformer</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">train_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_x</span><span class="p">)</span>
<span class="n">test_x_scl</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x_scl</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x_scl</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------
TEST
------------
[[1105   40]
 [   5   60]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_34_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_34_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 96.28%

Precision:  0.7977477477477477

Recall:  0.9440712126301647

F1 =  0.853658536585366

ROC AUC =  0.9568558951965066
</pre></div></div>
</div>
</section>
</section>
<section id="4---Feature-Selection">
<h2>4 - Feature Selection<a class="headerlink" href="#4---Feature-Selection" title="Permalink to this heading"></a></h2>
<p>Without much success at improving the F1-score using the data scalers, we will proceed to feature selection to improve the model. We start out with 5 features, and use feature selection to remove unneeded features.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feat_sel</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">SeqFeatSelection</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">forward</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">feat_sel</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">train_x_scl</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">train_y</span><span class="p">)</span>
<span class="n">train_x_sel</span> <span class="o">=</span> <span class="n">feat_sel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_x_scl</span><span class="p">)</span>
<span class="n">test_x_sel</span> <span class="o">=</span> <span class="n">feat_sel</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_x_scl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
No columns specified for imputation. These columns have been automatically identified:
[]
No columns specified for encoding. These columns have been automatically identfied as the following:
[]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
[Parallel(n_jobs=4)]: Using backend LokyBackend with 4 concurrent workers.
[Parallel(n_jobs=4)]: Done   5 out of   5 | elapsed:    3.6s finished

[2022-08-02 12:30:10] Features: 4/1 -- score: 0.8853169756008183[Parallel(n_jobs=4)]: Using backend LokyBackend with 4 concurrent workers.
[Parallel(n_jobs=4)]: Done   4 out of   4 | elapsed:    0.0s finished

[2022-08-02 12:30:10] Features: 3/1 -- score: 0.836481331623253[Parallel(n_jobs=3)]: Using backend LokyBackend with 3 concurrent workers.
[Parallel(n_jobs=3)]: Done   3 out of   3 | elapsed:    3.4s finished

[2022-08-02 12:30:14] Features: 2/1 -- score: 0.8715549855287846[Parallel(n_jobs=2)]: Using backend LokyBackend with 2 concurrent workers.
[Parallel(n_jobs=2)]: Done   2 out of   2 | elapsed:    3.2s finished

[2022-08-02 12:30:18] Features: 1/1 -- score: 0.5507882838618479
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feat_sel</span><span class="o">.</span><span class="n">get_selected_features</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;Mean_Green&#39;, &#39;Mean_Red&#39;, &#39;Mean_NIR&#39;, &#39;SD_pan&#39;]
</pre></div></div>
</div>
<p>Here, sequential feature selection has removed one of the features (SD_pan), which has led to a slight improvement in F1-score.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x_sel</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x_sel</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------
TEST
------------
[[1119   26]
 [   4   61]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_40_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_40_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 97.52%

Precision:  0.8487937687434111

Recall:  0.9578770574403762

F1 =  0.8947020328599276

ROC AUC =  0.9660194827007055
</pre></div></div>
</div>
</section>
<section id="5---Synthetic-Data">
<h2>5 - Synthetic Data<a class="headerlink" href="#5---Synthetic-Data" title="Permalink to this heading"></a></h2>
<section id="imblearn-Library">
<h3>imblearn Library<a class="headerlink" href="#imblearn-Library" title="Permalink to this heading"></a></h3>
<p>With unbalanced classes, we can instead choose to create synthetic data for the minority class. Here we use <code class="docutils literal notranslate"><span class="pre">Rebalance</span></code>, which connects to the <code class="docutils literal notranslate"><span class="pre">imblearn</span></code> library.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_y</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    3433
1     196
Name: class, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rebalance</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">(</span>
                            <span class="n">X</span><span class="o">=</span><span class="n">train_x_sel</span><span class="p">,</span>
                            <span class="n">y</span><span class="o">=</span><span class="n">train_y</span><span class="p">,</span>
                            <span class="n">strategy_over</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">3433</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="mi">400</span><span class="p">},</span>
                            <span class="n">over_sampler</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">under_sampler</span><span class="o">=</span><span class="kc">False</span>
                    <span class="p">)</span>
<span class="n">train_x_res</span><span class="p">,</span> <span class="n">train_y_res</span> <span class="o">=</span> <span class="n">rebalance</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">()</span>
<span class="n">train_y_res</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
No columns specified for imputation. These columns have been automatically identified:
[]
Running oversampling...
...finished
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    3433
1     400
Name: class, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">train_x_res</span><span class="p">,</span> <span class="n">train_y_res</span><span class="p">,</span> <span class="n">test_x_sel</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------
TEST
------------
[[1117   28]
 [   3   62]]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/dataprocessing_notebooks_case_study_case2_44_1.png" src="../../../_images/dataprocessing_notebooks_case_study_case2_44_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Acuracy: 97.44%

Precision:  0.8431051587301588

Recall:  0.9646960026872691

F1 =  0.8931567328918323

ROC AUC =  0.9732616728249917
</pre></div></div>
</div>
</section>
<section id="Creating-Artificial-Data-using-Deep-Learning">
<h3>Creating Artificial Data using Deep Learning<a class="headerlink" href="#Creating-Artificial-Data-using-Deep-Learning" title="Permalink to this heading"></a></h3>
<section id="CTGAN">
<h4>CTGAN<a class="headerlink" href="#CTGAN" title="Permalink to this heading"></a></h4>
<p>Let’s use the dataset with the original categorical variables, since CTGAN is capable of dealing with categorical variables internally. We will start by re-encoding the ordinal variables. We then proceed to split the dataset before using the CTGAN. This guarantees that we don’t contaminate our test set.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">synth</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">Synthesizer</span><span class="p">(</span>
                            <span class="n">X</span><span class="o">=</span><span class="n">train_x_sel</span><span class="p">,</span>
                            <span class="n">y</span><span class="o">=</span><span class="n">train_y</span><span class="p">,</span>
                            <span class="n">epochs</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                            <span class="n">model</span><span class="o">=</span><span class="s2">&quot;ctgan&quot;</span><span class="p">,</span>
                            <span class="n">load_existing</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
<span class="n">synth</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">conditions</span> <span class="o">=</span> <span class="p">{</span><span class="n">label_col</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>  <span class="c1"># create more of the undersampled class</span>
<span class="n">syn_train_x</span><span class="p">,</span> <span class="n">syn_train_y</span> <span class="o">=</span> <span class="n">synth</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">train_x_sel</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">train_y</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="n">conditions</span><span class="p">)</span>

<span class="n">syn_train_y</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading existing sythesizer model (CTGAN_400.pkl)...
LOADED model of class CTGAN.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0    3433
1     396
Name: class, dtype: int64
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">syn_train_x</span><span class="p">,</span> <span class="n">syn_train_y</span><span class="p">,</span> <span class="n">test_x_sel</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-intense-fg ansi-bold">c:\Users\morrissharp\Repos\responsible-ai-toolbox-mitigations\notebooks\dataprocessing\case_study\case2.ipynb Cell 47</span> in <span class="ansi-cyan-fg">&lt;cell line: 1&gt;</span><span class="ansi-blue-intense-fg ansi-bold">()</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; &lt;a href=&#39;vscode-notebook-cell:/c%3A/Users/morrissharp/Repos/responsible-ai-toolbox-mitigations/notebooks/dataprocessing/case_study/case2.ipynb#ch0000035?line=0&#39;&gt;1&lt;/a&gt;</span> model = dp.train_model_plot_results(syn_train_x, syn_train_y, test_x_sel, test_y, model_name=&#34;knn&#34;, train_result=False, plot_pr=False)

File <span class="ansi-green-intense-fg ansi-bold">c:\users\morrissharp\repos\responsible-ai-toolbox-mitigations\raimitigations\dataprocessing\model_utils.py:262</span>, in <span class="ansi-cyan-fg">train_model_plot_results</span><span class="ansi-blue-intense-fg ansi-bold">(x, y, x_test, y_test, model_name, train_result, plot_pr, best_th_auc)</span>
<span class="ansi-green-fg">    237</span> &#34;&#34;&#34;
<span class="ansi-green-fg">    238</span> Given a train and test sets, and a model name, this function instantiates the model,
<span class="ansi-green-fg">    239</span> fits the model to the train dataset, predicts the output for the train and test sets,
<span class="ansi-green-intense-fg ansi-bold">   (...)</span>
<span class="ansi-green-fg">    259</span>     the threshold is computed using the precision x recall graph.
<span class="ansi-green-fg">    260</span> &#34;&#34;&#34;
<span class="ansi-green-fg">    261</span> model = _get_model(model_name)
<span class="ansi-green-intense-fg ansi-bold">--&gt; 262</span> model.fit(x, y)
<span class="ansi-green-fg">    264</span> pred_train = model.predict_proba(x)[:, 1]
<span class="ansi-green-fg">    265</span> pred_test = model.predict_proba(x_test)[:, 1]

File <span class="ansi-green-intense-fg ansi-bold">c:\Users\morrissharp\Miniconda3\envs\rai\lib\site-packages\sklearn\neighbors\_classification.py:198</span>, in <span class="ansi-cyan-fg">KNeighborsClassifier.fit</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, y)</span>
<span class="ansi-green-fg">    179</span> &#34;&#34;&#34;Fit the k-nearest neighbors classifier from the training dataset.
<span class="ansi-green-fg">    180</span>
<span class="ansi-green-fg">    181</span> Parameters
<span class="ansi-green-intense-fg ansi-bold">   (...)</span>
<span class="ansi-green-fg">    194</span>     The fitted k-nearest neighbors classifier.
<span class="ansi-green-fg">    195</span> &#34;&#34;&#34;
<span class="ansi-green-fg">    196</span> self.weights = _check_weights(self.weights)
<span class="ansi-green-intense-fg ansi-bold">--&gt; 198</span> return self._fit(X, y)

File <span class="ansi-green-intense-fg ansi-bold">c:\Users\morrissharp\Miniconda3\envs\rai\lib\site-packages\sklearn\neighbors\_base.py:400</span>, in <span class="ansi-cyan-fg">NeighborsBase._fit</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, y)</span>
<span class="ansi-green-fg">    398</span> if self._get_tags()[&#34;requires_y&#34;]:
<span class="ansi-green-fg">    399</span>     if not isinstance(X, (KDTree, BallTree, NeighborsBase)):
<span class="ansi-green-intense-fg ansi-bold">--&gt; 400</span>         X, y = self._validate_data(X, y, accept_sparse=&#34;csr&#34;, multi_output=True)
<span class="ansi-green-fg">    402</span>     if is_classifier(self):
<span class="ansi-green-fg">    403</span>         # Classification targets require a specific format
<span class="ansi-green-fg">    404</span>         if y.ndim == 1 or y.ndim == 2 and y.shape[1] == 1:

File <span class="ansi-green-intense-fg ansi-bold">c:\Users\morrissharp\Miniconda3\envs\rai\lib\site-packages\sklearn\base.py:581</span>, in <span class="ansi-cyan-fg">BaseEstimator._validate_data</span><span class="ansi-blue-intense-fg ansi-bold">(self, X, y, reset, validate_separately, **check_params)</span>
<span class="ansi-green-fg">    579</span>         y = check_array(y, **check_y_params)
<span class="ansi-green-fg">    580</span>     else:
<span class="ansi-green-intense-fg ansi-bold">--&gt; 581</span>         X, y = check_X_y(X, y, **check_params)
<span class="ansi-green-fg">    582</span>     out = X, y
<span class="ansi-green-fg">    584</span> if not no_val_X and check_params.get(&#34;ensure_2d&#34;, True):

File <span class="ansi-green-intense-fg ansi-bold">c:\Users\morrissharp\Miniconda3\envs\rai\lib\site-packages\sklearn\utils\validation.py:964</span>, in <span class="ansi-cyan-fg">check_X_y</span><span class="ansi-blue-intense-fg ansi-bold">(X, y, accept_sparse, accept_large_sparse, dtype, order, copy, force_all_finite, ensure_2d, allow_nd, multi_output, ensure_min_samples, ensure_min_features, y_numeric, estimator)</span>
<span class="ansi-green-fg">    961</span> if y is None:
<span class="ansi-green-fg">    962</span>     raise ValueError(&#34;y cannot be None&#34;)
<span class="ansi-green-intense-fg ansi-bold">--&gt; 964</span> X = check_array(
<span class="ansi-green-fg">    965</span>     X,
<span class="ansi-green-fg">    966</span>     accept_sparse=accept_sparse,
<span class="ansi-green-fg">    967</span>     accept_large_sparse=accept_large_sparse,
<span class="ansi-green-fg">    968</span>     dtype=dtype,
<span class="ansi-green-fg">    969</span>     order=order,
<span class="ansi-green-fg">    970</span>     copy=copy,
<span class="ansi-green-fg">    971</span>     force_all_finite=force_all_finite,
<span class="ansi-green-fg">    972</span>     ensure_2d=ensure_2d,
<span class="ansi-green-fg">    973</span>     allow_nd=allow_nd,
<span class="ansi-green-fg">    974</span>     ensure_min_samples=ensure_min_samples,
<span class="ansi-green-fg">    975</span>     ensure_min_features=ensure_min_features,
<span class="ansi-green-fg">    976</span>     estimator=estimator,
<span class="ansi-green-fg">    977</span> )
<span class="ansi-green-fg">    979</span> y = _check_y(y, multi_output=multi_output, y_numeric=y_numeric)
<span class="ansi-green-fg">    981</span> check_consistent_length(X, y)

File <span class="ansi-green-intense-fg ansi-bold">c:\Users\morrissharp\Miniconda3\envs\rai\lib\site-packages\sklearn\utils\validation.py:800</span>, in <span class="ansi-cyan-fg">check_array</span><span class="ansi-blue-intense-fg ansi-bold">(array, accept_sparse, accept_large_sparse, dtype, order, copy, force_all_finite, ensure_2d, allow_nd, ensure_min_samples, ensure_min_features, estimator)</span>
<span class="ansi-green-fg">    794</span>         raise ValueError(
<span class="ansi-green-fg">    795</span>             &#34;Found array with dim %d. %s expected &lt;= 2.&#34;
<span class="ansi-green-fg">    796</span>             % (array.ndim, estimator_name)
<span class="ansi-green-fg">    797</span>         )
<span class="ansi-green-fg">    799</span>     if force_all_finite:
<span class="ansi-green-intense-fg ansi-bold">--&gt; 800</span>         _assert_all_finite(array, allow_nan=force_all_finite == &#34;allow-nan&#34;)
<span class="ansi-green-fg">    802</span> if ensure_min_samples &gt; 0:
<span class="ansi-green-fg">    803</span>     n_samples = _num_samples(array)

File <span class="ansi-green-intense-fg ansi-bold">c:\Users\morrissharp\Miniconda3\envs\rai\lib\site-packages\sklearn\utils\validation.py:114</span>, in <span class="ansi-cyan-fg">_assert_all_finite</span><span class="ansi-blue-intense-fg ansi-bold">(X, allow_nan, msg_dtype)</span>
<span class="ansi-green-fg">    107</span>     if (
<span class="ansi-green-fg">    108</span>         allow_nan
<span class="ansi-green-fg">    109</span>         and np.isinf(X).any()
<span class="ansi-green-fg">    110</span>         or not allow_nan
<span class="ansi-green-fg">    111</span>         and not np.isfinite(X).all()
<span class="ansi-green-fg">    112</span>     ):
<span class="ansi-green-fg">    113</span>         type_err = &#34;infinity&#34; if allow_nan else &#34;NaN, infinity&#34;
<span class="ansi-green-intense-fg ansi-bold">--&gt; 114</span>         raise ValueError(
<span class="ansi-green-fg">    115</span>             msg_err.format(
<span class="ansi-green-fg">    116</span>                 type_err, msg_dtype if msg_dtype is not None else X.dtype
<span class="ansi-green-fg">    117</span>             )
<span class="ansi-green-fg">    118</span>         )
<span class="ansi-green-fg">    119</span> # for object dtype data, we only check for NaNs (GH-13254)
<span class="ansi-green-fg">    120</span> elif X.dtype == np.dtype(&#34;object&#34;) and not allow_nan:

<span class="ansi-red-intense-fg ansi-bold">ValueError</span>: Input contains NaN, infinity or a value too large for dtype(&#39;float64&#39;).
</pre></div></div>
</div>
<p>Let’s try creating more artificial instances and check how this impacts the model’s performance.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">conditions</span> <span class="o">=</span> <span class="p">{</span><span class="n">label_col</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>  <span class="c1"># create more of the undersampled class</span>
<span class="n">syn_train_x</span><span class="p">,</span> <span class="n">syn_train_y</span> <span class="o">=</span> <span class="n">synth</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">train_x_sel</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">train_y</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="n">conditions</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">syn_train_x</span><span class="p">,</span> <span class="n">syn_train_y</span><span class="p">,</span> <span class="n">test_x_sel</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="TVAE">
<h4>TVAE<a class="headerlink" href="#TVAE" title="Permalink to this heading"></a></h4>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">synth</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">Synthesizer</span><span class="p">(</span>
                            <span class="n">X</span><span class="o">=</span><span class="n">train_x_sel</span><span class="p">,</span>
                            <span class="n">y</span><span class="o">=</span><span class="n">train_y</span><span class="p">,</span>
                            <span class="n">epochs</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                            <span class="n">model</span><span class="o">=</span><span class="s2">&quot;tvae&quot;</span><span class="p">,</span>
                            <span class="n">load_existing</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
<span class="n">synth</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">conditions</span> <span class="o">=</span> <span class="p">{</span><span class="n">label_col</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>  <span class="c1"># create more of the undersampled class</span>
<span class="n">syn2_train_x</span><span class="p">,</span> <span class="n">syn2_train_y</span> <span class="o">=</span> <span class="n">synth</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">train_x_sel</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">train_y</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">conditions</span><span class="o">=</span><span class="n">conditions</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">train_model_plot_results</span><span class="p">(</span><span class="n">syn2_train_x</span><span class="p">,</span> <span class="n">syn2_train_y</span><span class="p">,</span> <span class="n">test_x_sel</span><span class="p">,</span> <span class="n">test_y</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;knn&quot;</span><span class="p">,</span> <span class="n">train_result</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_pr</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="case1.html" class="btn btn-neutral float-left" title="Case Study 1" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="case3.html" class="btn btn-neutral float-right" title="Case Study 3" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Microsoft.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>