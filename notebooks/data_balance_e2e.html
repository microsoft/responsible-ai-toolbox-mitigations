<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>End to End Data Balance and Error Mitigation &mdash; Responsible AI Mitigations  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="DataProcessing" href="../dataprocessing/intro.html" />
    <link rel="prev" title="Case Study 3 - Multiple Runs" href="dataprocessing/case_study/case3_stat.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Responsible AI Mitigations
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install_guide.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../integration_to_libs.html">How this library works with the Responsible AI Toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../gallery.html">Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../gallery.html#tutorials">Tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../gallery.html#case-studies">Case Studies</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../gallery.html#using-the-dataprocessing-module">Using the DataProcessing Module</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../gallery.html#using-the-databalanceanalysis-module">Using the DataBalanceAnalysis Module</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">End to End Data Balance and Error Mitigation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../gallery.html#using-the-cohort-module">Using the Cohort Module</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dataprocessing/intro.html">DataProcessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../databalanceanalysis/intro.html">DataBalanceAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cohort/intro.html">Cohort</a></li>
<li class="toctree-l1"><a class="reference internal" href="../utils/utils.html">Utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Responsible AI Mitigations</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../gallery.html">Gallery</a></li>
      <li class="breadcrumb-item active">End to End Data Balance and Error Mitigation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com//microsoft/responsible-ai-toolbox-mitigations/blob/main/docs/notebooks/data_balance_e2e.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="End-to-End-Data-Balance-and-Error-Mitigation">
<h1>End to End Data Balance and Error Mitigation<a class="headerlink" href="#End-to-End-Data-Balance-and-Error-Mitigation" title="Permalink to this heading"></a></h1>
<p>This Notebook will demonstrate how to use both the Data Balance Analysis capabilities and error mitigation functions together using an example HR dataset which is a tabular dataset with a label column that indicates whether or not a person is promoted based on attributes such as education, gender, number of trainings, and other factors. The steps that we will take in this notebook are</p>
<ol class="arabic simple">
<li><p>We will first conduct an analysis on how balanced the data is.</p></li>
<li><p>We will train an example model to see how it performs on the data using metrics and the Responsible AI Error Analysis Dashboard.</p></li>
<li><p>We will try to balance the data to mitigate biases that may have resulted from unbalanced data</p></li>
<li><p>We will train a new model using our data after applying the rebalance</p></li>
<li><p>We will then compare model performance before and after mitigating data imbalances by again using various performance metrics and the Error Analysis Dashboard.</p></li>
</ol>
<p>First we import all the dependencies needed in our analysis. This includes the classes to produce the data balance metrics, the sklearn functions to see the model performance and the error mitigation steps like DataRebalance and DataSplit that we apply to the dataset itself.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">metrics</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">classification_report</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OrdinalEncoder</span>

<span class="kn">from</span> <span class="nn">raimitigations.utils</span> <span class="kn">import</span> <span class="n">split_data</span>
<span class="kn">import</span> <span class="nn">raimitigations.dataprocessing</span> <span class="k">as</span> <span class="nn">dp</span>
<span class="kn">from</span> <span class="nn">raimitigations.databalanceanalysis</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FeatureBalanceMeasure</span><span class="p">,</span>
    <span class="n">AggregateBalanceMeasure</span><span class="p">,</span>
    <span class="n">DistributionBalanceMeasure</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">raimitigations.cohort</span> <span class="kn">import</span> <span class="n">CohortManager</span>
<span class="kn">from</span> <span class="nn">download</span> <span class="kn">import</span> <span class="n">download_datasets</span>
</pre></div>
</div>
</div>
<section id="Train-LightGBM-Model">
<h2>Train LightGBM Model<a class="headerlink" href="#Train-LightGBM-Model" title="Permalink to this heading"></a></h2>
<p>Now we import the tabular dataset that we will look at in the example, we load it into a pandas dataframe that we can then modify and use for all the other steps. For the data balance analysis portion we need our label columns and a list of sensitive columns that are interested in checking for balance.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&quot;../datasets/&quot;</span>
<span class="n">download_datasets</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">&#39;hr_promotion/train.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;employee_id&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>department</th>
      <th>region</th>
      <th>education</th>
      <th>gender</th>
      <th>recruitment_channel</th>
      <th>no_of_trainings</th>
      <th>age</th>
      <th>previous_year_rating</th>
      <th>length_of_service</th>
      <th>KPIs_met &gt;80%</th>
      <th>awards_won?</th>
      <th>avg_training_score</th>
      <th>is_promoted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sales &amp; Marketing</td>
      <td>region_7</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>35</td>
      <td>5.0</td>
      <td>8</td>
      <td>1</td>
      <td>0</td>
      <td>49</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Operations</td>
      <td>region_22</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>30</td>
      <td>5.0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Sales &amp; Marketing</td>
      <td>region_19</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>34</td>
      <td>3.0</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Sales &amp; Marketing</td>
      <td>region_23</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>2</td>
      <td>39</td>
      <td>1.0</td>
      <td>10</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Technology</td>
      <td>region_26</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>45</td>
      <td>3.0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>73</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>54803</th>
      <td>Technology</td>
      <td>region_14</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>48</td>
      <td>3.0</td>
      <td>17</td>
      <td>0</td>
      <td>0</td>
      <td>78</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54804</th>
      <td>Operations</td>
      <td>region_27</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>other</td>
      <td>1</td>
      <td>37</td>
      <td>2.0</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54805</th>
      <td>Analytics</td>
      <td>region_1</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>27</td>
      <td>5.0</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>79</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54806</th>
      <td>Sales &amp; Marketing</td>
      <td>region_9</td>
      <td>NaN</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>29</td>
      <td>1.0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>45</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54807</th>
      <td>HR</td>
      <td>region_22</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>27</td>
      <td>1.0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>49</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>54808 rows × 13 columns</p>
</div></div>
</div>
<p>We do some data transformation on the categorical columns in order to make the training data input in the format that the lightGBM model expects. Although lightGBM can internally deal with categorical columns that the user specifies, we need to encode those categories into integers before we are able to train the lightGBM model on it, so we create a scikit pipeline contains the encoder and the LGBM classifier.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cols_of_interest</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;education&quot;</span><span class="p">,</span> <span class="s2">&quot;recruitment_channel&quot;</span><span class="p">]</span>
<span class="n">categorical_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;department&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gender&quot;</span><span class="p">,</span>
    <span class="s2">&quot;education&quot;</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">,</span>
    <span class="s2">&quot;recruitment_channel&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">label_col</span> <span class="o">=</span> <span class="s2">&quot;is_promoted&quot;</span>
<span class="n">seed</span> <span class="o">=</span> <span class="mi">42</span>
<span class="c1"># handle duplicates</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>department</th>
      <th>region</th>
      <th>education</th>
      <th>gender</th>
      <th>recruitment_channel</th>
      <th>no_of_trainings</th>
      <th>age</th>
      <th>previous_year_rating</th>
      <th>length_of_service</th>
      <th>KPIs_met &gt;80%</th>
      <th>awards_won?</th>
      <th>avg_training_score</th>
      <th>is_promoted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sales &amp; Marketing</td>
      <td>region_7</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>35</td>
      <td>5.0</td>
      <td>8</td>
      <td>1</td>
      <td>0</td>
      <td>49</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Operations</td>
      <td>region_22</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>30</td>
      <td>5.0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Sales &amp; Marketing</td>
      <td>region_19</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>34</td>
      <td>3.0</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Sales &amp; Marketing</td>
      <td>region_23</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>2</td>
      <td>39</td>
      <td>1.0</td>
      <td>10</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Technology</td>
      <td>region_26</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>45</td>
      <td>3.0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>73</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s2">&quot;ohe&quot;</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">EncoderOHE</span><span class="p">(</span><span class="n">col_encode</span><span class="o">=</span><span class="n">categorical_cols</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
            <span class="p">])</span>
</pre></div>
</div>
</div>
<p>Here we do a split on the data, train a LightGBM model using the scikit pipeline we created, and see how this model does on some test data. After this processing, we train the model and we can see that the model does well on false values, getting 97.3% of them correct, but the model does a lot worse on the true values, only identifying approximately a third of the true positives correctly.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">conf_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
    <span class="p">((</span><span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">),</span> <span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">))</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
    <span class="p">((</span><span class="n">tnr</span><span class="p">,</span> <span class="n">fpr</span><span class="p">),</span> <span class="p">(</span><span class="n">fnr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">))</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="s2">&quot;true&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;TP = </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">tpr</span><span class="si">:</span><span class="s2">1.2%</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;FN = </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">fnr</span><span class="si">:</span><span class="s2">1.2%</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;FP = </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">fpr</span><span class="si">:</span><span class="s2">1.2%</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;TN = </span><span class="si">{</span><span class="n">tn</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">tnr</span><span class="si">:</span><span class="s2">1.2%</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">],</span>
        <span class="p">],</span>
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">],</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Pred 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Pred 0&quot;</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Train a model and get accuracy numbers</span>
<span class="c1"># splitting the dataset</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">label_col</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="c1"># fitting the pipeline and predicting</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;number of errors on test dataset: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">pred</span> <span class="o">!=</span> <span class="n">y_test</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conf_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
number of errors on test dataset: 293
                  Pred 1              Pred 0
True   TP = 142 (33.57%)   FN = 281 (66.43%)
False    FP = 12 (0.27%)  TN = 4426 (99.73%)
              precision    recall  f1-score   support

           0       0.94      1.00      0.97      4438
           1       0.92      0.34      0.49       423

    accuracy                           0.94      4861
   macro avg       0.93      0.67      0.73      4861
weighted avg       0.94      0.94      0.93      4861

</pre></div></div>
</div>
</section>
<section id="Error-Analysis-on-Baseline-Model">
<h2>Error Analysis on Baseline Model<a class="headerlink" href="#Error-Analysis-on-Baseline-Model" title="Permalink to this heading"></a></h2>
<p>Now that we have a baseline model to work with, we can see how this model is doing overall on the data and see if there are any cohorts within the data that the model performs worse on. Even if the model has a high accuracy, we want to make sure that accuracy is applicable over different sensitive groups. We use the <a class="reference external" href="https://erroranalysis.ai/">Error Analysis Dashboard</a> to determine which cohorts of data this model performs worse on. To install this library, use the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt; pip install raiwidgets</span>
</pre></div>
</div>
<p>In the following cell, we set up the parameters required by the <a class="reference external" href="https://github.com/microsoft/responsible-ai-toolbox">Responsible AI Toolbox</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">raiwidgets</span> <span class="kn">import</span> <span class="n">ResponsibleAIDashboard</span>
<span class="kn">from</span> <span class="nn">responsibleai</span> <span class="kn">import</span> <span class="n">RAIInsights</span>
<span class="kn">from</span> <span class="nn">raiwidgets.cohort</span> <span class="kn">import</span> <span class="n">Cohort</span><span class="p">,</span> <span class="n">CohortFilter</span><span class="p">,</span> <span class="n">CohortFilterMethods</span>

<span class="n">df_train</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_train</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_train</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">x_test</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_test</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_test</span>

<span class="n">rai_insights</span> <span class="o">=</span> <span class="n">RAIInsights</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">df_train</span><span class="p">,</span> <span class="n">df_test</span><span class="p">,</span> <span class="n">label_col</span><span class="p">,</span> <span class="s1">&#39;classification&#39;</span><span class="p">,</span>
                           <span class="n">categorical_features</span><span class="o">=</span><span class="n">pipeline</span><span class="p">[</span><span class="s1">&#39;ohe&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_encoded_columns</span><span class="p">())</span>

<span class="c1"># Error Analysis</span>
<span class="n">rai_insights</span><span class="o">.</span><span class="n">error_analysis</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>

<span class="n">rai_insights</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Using categorical_feature in Dataset.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
Passing a set as an indexer is deprecated and will raise in a future version. Use a list instead.
</pre></div></div>
</div>
<p>We can now create the dashboard, which will be available in the local host. Open your browser on the indicated local host address and you’ll be able to interact with the dashboard.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ResponsibleAIDashboard</span><span class="p">(</span><span class="n">rai_insights</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
ResponsibleAI started at http://localhost:5000
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;raiwidgets.responsibleai_dashboard.ResponsibleAIDashboard at 0x7f77dbaf08b0&gt;
</pre></div></div>
</div>
<p>Since the error analysis dashboard is interactive and too large to render on Github, we will include screenshots from our analysis.</p>
<p><img alt="screen1" src="../_images/error_analysis_adult_census3.png" /></p>
<p><img alt="screen2" src="../_images/error_analysis1.png" /></p>
<p><img alt="screen3" src="../_images/error_analysis2.png" /></p>
<p>From these screenshots we can see that if we zoom in on certain cohorts that the model is getting more errors on, that region, department and education are all attributes that are involved in those cohorts. For the purpose of this example, we chose remove some of the other columns like KPIs_met from the error analysis since we want to focus on attributes that may lead to biases rather than more measurable attributes. We will focus on analyzing and mitigating errors within the department and
education columns for the rest of the analysis.</p>
</section>
<section id="Data-Balance-Analysis">
<h2>Data Balance Analysis<a class="headerlink" href="#Data-Balance-Analysis" title="Permalink to this heading"></a></h2>
<p>First we can take a look at the feature balance measures. These measures indicate the difference in the label column amongst different feature values. For example the first row here indicates if people with the “Masters &amp; above” education has a different proportion of people receiving the promoted outcome than those that have a Bachelor’s. Lower values of these measures indicates that the amounts of people with class A vs versus those with class B with a label of 1 is similar. The t-test value
can also tell us if the difference we see is statistically significant.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_measures</span> <span class="o">=</span> <span class="n">FeatureBalanceMeasure</span><span class="p">(</span><span class="n">cols_of_interest</span><span class="p">,</span> <span class="n">label_col</span><span class="p">)</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">train_df</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_train</span>

<span class="n">feat_measures1</span> <span class="o">=</span> <span class="n">feature_measures</span><span class="o">.</span><span class="n">measures</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">feat_measures1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ClassA</th>
      <th>ClassB</th>
      <th>FeatureName</th>
      <th>dp</th>
      <th>pmi</th>
      <th>sdc</th>
      <th>ji</th>
      <th>krc</th>
      <th>llr</th>
      <th>t_test</th>
      <th>ttest_pvalue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Master's &amp; above</td>
      <td>Bachelor's</td>
      <td>education</td>
      <td>0.017814</td>
      <td>0.197252</td>
      <td>0.004788</td>
      <td>0.005594</td>
      <td>4.996442</td>
      <td>-0.622067</td>
      <td>0.262386</td>
      <td>0.408789</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Master's &amp; above</td>
      <td>Below Secondary</td>
      <td>education</td>
      <td>0.022587</td>
      <td>0.257448</td>
      <td>0.069726</td>
      <td>0.076144</td>
      <td>-27.035372</td>
      <td>3.718893</td>
      <td>-2.623174</td>
      <td>0.059886</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Bachelor's</td>
      <td>Below Secondary</td>
      <td>education</td>
      <td>0.004773</td>
      <td>0.060196</td>
      <td>0.064938</td>
      <td>0.070550</td>
      <td>-32.031814</td>
      <td>4.340960</td>
      <td>-2.885561</td>
      <td>0.051023</td>
    </tr>
    <tr>
      <th>0</th>
      <td>sourcing</td>
      <td>other</td>
      <td>recruitment_channel</td>
      <td>0.002630</td>
      <td>0.030454</td>
      <td>-0.000794</td>
      <td>-0.000925</td>
      <td>1.579734</td>
      <td>-0.240590</td>
      <td>0.085323</td>
      <td>0.469888</td>
    </tr>
    <tr>
      <th>1</th>
      <td>sourcing</td>
      <td>referred</td>
      <td>recruitment_channel</td>
      <td>-0.038804</td>
      <td>-0.366366</td>
      <td>0.048196</td>
      <td>0.053285</td>
      <td>-18.723860</td>
      <td>2.639673</td>
      <td>-1.733789</td>
      <td>0.112546</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">educations</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s2">&quot;education&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">education_dp_values</span> <span class="o">=</span> <span class="n">feat_measures1</span><span class="p">[</span><span class="n">feat_measures1</span><span class="p">[</span><span class="s2">&quot;FeatureName&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;education&quot;</span><span class="p">][</span>
    <span class="p">[</span><span class="s2">&quot;ClassA&quot;</span><span class="p">,</span> <span class="s2">&quot;ClassB&quot;</span><span class="p">,</span> <span class="s2">&quot;pmi&quot;</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">education_dp_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">educations</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">educations</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">education_dp_values</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">class_a</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">class_b</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dp_value</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">educations</span> <span class="o">==</span> <span class="n">class_a</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">educations</span> <span class="o">==</span> <span class="n">class_b</span><span class="p">)</span>
    <span class="n">dp_value</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">dp_value</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">education_dp_array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">dp_value</span>
    <span class="n">education_dp_array</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">dp_value</span>

<span class="n">colormap</span> <span class="o">=</span> <span class="s2">&quot;RdBu&quot;</span>
<span class="n">dp_min</span><span class="p">,</span> <span class="n">dp_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">education_dp_array</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">dp_min</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">dp_max</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">)</span>

<span class="n">cbar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Point Mutual Info&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">educations</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">educations</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">educations</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">educations</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">educations</span><span class="p">)):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">educations</span><span class="p">)):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">education_dp_array</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span>
        <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;PMI of education in HR Dataset&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_balance_e2e_19_0.png" src="../_images/notebooks_data_balance_e2e_19_0.png" />
</div>
</div>
<p>Next we can take a look at the distribution balance measures. These measures each of the columns of interest that we selected to the uniform distribution of those values. Values that are closer to zero indicate that the difference between the actual distribution of the data and the uniform distribution of values. We find that these values are pretty far from zero, so they don’t align to a uniform distribution well before we make any modifications to the original data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist_measures</span> <span class="o">=</span> <span class="n">DistributionBalanceMeasure</span><span class="p">(</span><span class="n">cols_of_interest</span><span class="p">)</span>
<span class="n">dist_measures1</span> <span class="o">=</span> <span class="n">dist_measures</span><span class="o">.</span><span class="n">measures</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">dist_measures1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FeatureName</th>
      <th>kl_divergence</th>
      <th>js_dist</th>
      <th>wasserstein_dist</th>
      <th>inf_norm_dist</th>
      <th>total_variation_dist</th>
      <th>chi_sq_p_value</th>
      <th>chi_sq_stat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>education</td>
      <td>0.434946</td>
      <td>0.358906</td>
      <td>0.236105</td>
      <td>0.354158</td>
      <td>0.354158</td>
      <td>0.0</td>
      <td>30343.542312</td>
    </tr>
    <tr>
      <th>1</th>
      <td>recruitment_channel</td>
      <td>0.327144</td>
      <td>0.315774</td>
      <td>0.208248</td>
      <td>0.312371</td>
      <td>0.312371</td>
      <td>0.0</td>
      <td>20349.678919</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">measures_of_interest</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;kl_divergence&quot;</span><span class="p">,</span>
    <span class="s2">&quot;js_dist&quot;</span><span class="p">,</span>
    <span class="s2">&quot;inf_norm_dist&quot;</span><span class="p">,</span>
    <span class="s2">&quot;total_variation_dist&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wasserstein_dist&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">education_measures</span> <span class="o">=</span> <span class="n">dist_measures1</span><span class="p">[</span><span class="n">dist_measures1</span><span class="p">[</span><span class="s2">&quot;FeatureName&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;education&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
    <span class="mi">0</span>
<span class="p">]</span>
<span class="n">recruitment_measures</span> <span class="o">=</span> <span class="n">dist_measures1</span><span class="p">[</span>
    <span class="n">dist_measures1</span><span class="p">[</span><span class="s2">&quot;FeatureName&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;recruitment_channel&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">education_array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">education_measures</span><span class="p">[</span><span class="n">measure</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">measure</span> <span class="ow">in</span> <span class="n">measures_of_interest</span>
<span class="p">]</span>
<span class="n">recruitment_array</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nb">round</span><span class="p">(</span><span class="n">recruitment_measures</span><span class="p">[</span><span class="n">measure</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span> <span class="k">for</span> <span class="n">measure</span> <span class="ow">in</span> <span class="n">measures_of_interest</span>
<span class="p">]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">measures_of_interest</span><span class="p">))</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.35</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">rects1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">education_array</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;education&quot;</span><span class="p">)</span>
<span class="n">rects2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">recruitment_array</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;recruitment_channel&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Measure&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Value&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Distribution Balance Measures of Education and Recruitment Channel in Adult Dataset&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">measures_of_interest</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">autolabel</span><span class="p">(</span><span class="n">rects</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">rect</span> <span class="ow">in</span> <span class="n">rects</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">height</span><span class="p">),</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">rect</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span>
            <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># 1 point vertical offset</span>
            <span class="n">textcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
        <span class="p">)</span>


<span class="n">autolabel</span><span class="p">(</span><span class="n">rects1</span><span class="p">)</span>
<span class="n">autolabel</span><span class="p">(</span><span class="n">rects2</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_data_balance_e2e_22_0.png" src="../_images/notebooks_data_balance_e2e_22_0.png" />
</div>
</div>
<p>We can also look at aggregate balance measures which indicate a notion of overall inequality in the data. We can see that the Atkinson Index is 0.79. This means that in order to create a perfectly balanced dataset over these measures we would need to forgo 79.9% of the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">agg_measures</span> <span class="o">=</span> <span class="n">AggregateBalanceMeasure</span><span class="p">(</span><span class="n">cols_of_interest</span><span class="p">)</span>
<span class="n">agg_measures1</span> <span class="o">=</span> <span class="n">agg_measures</span><span class="o">.</span><span class="n">measures</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">agg_measures1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>theil_l_index</th>
      <th>theil_t_index</th>
      <th>atkinson_index</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.600814</td>
      <td>0.762696</td>
      <td>0.798268</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Error-Mitigation:-Rebalancing-dataset">
<h2>Error Mitigation: Rebalancing dataset<a class="headerlink" href="#Error-Mitigation:-Rebalancing-dataset" title="Permalink to this heading"></a></h2>
<p>In order to rebalance the data we can choose from three different methods of under or oversampling. These are SMOTE, Tomek and SMOTE-Tomek. SMOTE is an oversampling technique for the less represented class. Tomek is an undersampling technique that would be applied to the more represented class. Smote-Tomek is when both of these methods are applied in conjunction on the dataset. In this example, we will choose to use the SMOTE sampling technique on the columns of interest. The rebalance operation
is originally aimed for a single column, that is, the entire dataset is rebalanced based on one column. However, the <code class="docutils literal notranslate"><span class="pre">CohortManager</span></code> class allows us to specify a set of cohorts, where the rebalance operation will then be applied to each cohort individually.</p>
<p>In the next cell, we will rebalance our dataset using the <code class="docutils literal notranslate"><span class="pre">recruitment_channel</span></code> column as the target column, and the <code class="docutils literal notranslate"><span class="pre">education</span></code> column as the cohort division, that is, the <code class="docutils literal notranslate"><span class="pre">CohortManager</span></code> class will first separate the dataset into multiple cohorts, one for each of the existing values in the <code class="docutils literal notranslate"><span class="pre">education</span></code> column. Next, it will run the rebalance operation (over the <code class="docutils literal notranslate"><span class="pre">recruitment_channel</span></code> column) for each cohort separately.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_df2</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">rebalance</span> <span class="o">=</span> <span class="n">dp</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">(</span><span class="n">k_neighbors</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cht_manager</span> <span class="o">=</span> <span class="n">CohortManager</span><span class="p">(</span><span class="n">transform_pipe</span><span class="o">=</span><span class="n">rebalance</span><span class="p">,</span> <span class="n">cohort_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;education&#39;</span><span class="p">])</span>
<span class="n">smote_df</span> <span class="o">=</span> <span class="n">cht_manager</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">train_df2</span><span class="p">,</span> <span class="n">rebalance_col</span><span class="o">=</span><span class="s1">&#39;recruitment_channel&#39;</span><span class="p">)</span>

<span class="n">smote_df</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>department</th>
      <th>region</th>
      <th>education</th>
      <th>gender</th>
      <th>no_of_trainings</th>
      <th>age</th>
      <th>previous_year_rating</th>
      <th>length_of_service</th>
      <th>KPIs_met &gt;80%</th>
      <th>awards_won?</th>
      <th>avg_training_score</th>
      <th>is_promoted</th>
      <th>recruitment_channel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Procurement</td>
      <td>region_7</td>
      <td>Bachelor's</td>
      <td>f</td>
      <td>1</td>
      <td>29</td>
      <td>3.000000</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>74</td>
      <td>0</td>
      <td>other</td>
    </tr>
    <tr>
      <th>1</th>
      <td>HR</td>
      <td>region_2</td>
      <td>Bachelor's</td>
      <td>f</td>
      <td>1</td>
      <td>56</td>
      <td>3.000000</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>46</td>
      <td>0</td>
      <td>other</td>
    </tr>
    <tr>
      <th>2</th>
      <td>HR</td>
      <td>region_7</td>
      <td>Bachelor's</td>
      <td>f</td>
      <td>2</td>
      <td>30</td>
      <td>4.000000</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>46</td>
      <td>0</td>
      <td>sourcing</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Sales &amp; Marketing</td>
      <td>region_7</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>2</td>
      <td>31</td>
      <td>4.000000</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>48</td>
      <td>0</td>
      <td>other</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Finance</td>
      <td>region_2</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>2</td>
      <td>47</td>
      <td>3.000000</td>
      <td>7</td>
      <td>1</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
      <td>sourcing</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>72892</th>
      <td>Technology</td>
      <td>region_2</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>1</td>
      <td>40</td>
      <td>4.000000</td>
      <td>13</td>
      <td>1</td>
      <td>0</td>
      <td>81</td>
      <td>0</td>
      <td>sourcing</td>
    </tr>
    <tr>
      <th>72893</th>
      <td>Operations</td>
      <td>region_22</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>1</td>
      <td>37</td>
      <td>3.000000</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>61</td>
      <td>0</td>
      <td>sourcing</td>
    </tr>
    <tr>
      <th>72894</th>
      <td>Operations</td>
      <td>region_1</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>1</td>
      <td>30</td>
      <td>3.254223</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
      <td>sourcing</td>
    </tr>
    <tr>
      <th>72895</th>
      <td>Sales &amp; Marketing</td>
      <td>region_22</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>1</td>
      <td>45</td>
      <td>4.595457</td>
      <td>16</td>
      <td>0</td>
      <td>0</td>
      <td>55</td>
      <td>0</td>
      <td>sourcing</td>
    </tr>
    <tr>
      <th>72896</th>
      <td>Sales &amp; Marketing</td>
      <td>region_7</td>
      <td>Master's &amp; above</td>
      <td>m</td>
      <td>1</td>
      <td>28</td>
      <td>3.000000</td>
      <td>3</td>
      <td>0</td>
      <td>0</td>
      <td>48</td>
      <td>0</td>
      <td>sourcing</td>
    </tr>
  </tbody>
</table>
<p>72897 rows × 13 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">smote_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
43746
72897
</pre></div></div>
</div>
<p>After applying the SMOTE Rebalancing mitigation, we get a dataset that is much larger than the original data frame. The SMOTE Method applies oversampling in order to balance the dataset.</p>
</section>
<section id="New-Model-on-Rebalanced-Datasets">
<h2>New Model on Rebalanced Datasets<a class="headerlink" href="#New-Model-on-Rebalanced-Datasets" title="Permalink to this heading"></a></h2>
<p>After applying the SMOTE Method on the data, we can then train a new lightGBM model on this newly balanced data and see if there are differences in model performance based on this balancing. We compare the results below and find that the new model trained on the data post rebalancing does a better job predicting true positives than the original model and thus has greater recall and overall precision. So not only does data rebalancing help with making sure a model is less biased, it also helps
the model actually fit and be able to predict the data outcomes more accurately.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x_train2</span> <span class="o">=</span> <span class="n">smote_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">label_col</span><span class="p">])</span>
<span class="n">y_train2</span> <span class="o">=</span> <span class="n">smote_df</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span>

<span class="n">pipeline2</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
                <span class="p">(</span><span class="s2">&quot;ohe&quot;</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">EncoderOHE</span><span class="p">(</span><span class="n">col_encode</span><span class="o">=</span><span class="n">categorical_cols</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
                <span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)),</span>
            <span class="p">])</span>

<span class="n">pipeline2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span>

<span class="n">pred2</span> <span class="o">=</span> <span class="n">pipeline2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
<span class="n">pred_model1</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We compare the number of error that the model 1 that was trained before rebalancing and model 2 that was trained after rebalancing have and we find that overall there are less errors with model 2.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare Results</span>
<span class="k">class</span> <span class="nc">color</span><span class="p">:</span>
    <span class="n">PURPLE</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[95m&quot;</span>
    <span class="n">CYAN</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[96m&quot;</span>
    <span class="n">DARKCYAN</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[36m&quot;</span>
    <span class="n">BLUE</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[94m&quot;</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[92m&quot;</span>
    <span class="n">YELLOW</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[93m&quot;</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[91m&quot;</span>
    <span class="n">BOLD</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1m&quot;</span>
    <span class="n">UNDERLINE</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[4m&quot;</span>
    <span class="n">END</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[0m&quot;</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">color</span><span class="o">.</span><span class="n">PURPLE</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">BOLD</span>
    <span class="o">+</span> <span class="s2">&quot;BEFORE: &quot;</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">END</span>
    <span class="o">+</span> <span class="s2">&quot;number of test dataset instances: &quot;</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">BOLD</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">GREEN</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">END</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;      : number of errors on test dataset: &quot;</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">BOLD</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">RED</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">pred_model1</span> <span class="o">!=</span> <span class="n">y_test</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">END</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">color</span><span class="o">.</span><span class="n">PURPLE</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">BOLD</span>
    <span class="o">+</span> <span class="s2">&quot;AFTER:  &quot;</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">END</span>
    <span class="o">+</span> <span class="s2">&quot;number of test dataset instances: &quot;</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">BOLD</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">GREEN</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">END</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;     :  number of errors on test dataset: &quot;</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">BOLD</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">RED</span>
    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">pred2</span> <span class="o">!=</span> <span class="n">y_test</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">END</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

<span class="ansi-magenta-intense-fg ansi-bold">BEFORE: </span>number of test dataset instances: <span class="ansi-green-intense-fg ansi-bold">4861</span>
      : number of errors on test dataset: <span class="ansi-red-intense-fg ansi-bold">293</span>

<span class="ansi-magenta-intense-fg ansi-bold">AFTER:  </span>number of test dataset instances: <span class="ansi-green-intense-fg ansi-bold">4861</span>
     :  number of errors on test dataset: <span class="ansi-red-intense-fg ansi-bold">299</span>

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare conf matrices</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">BLUE</span> <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">BOLD</span> <span class="o">+</span> <span class="s2">&quot;BEFORE: conf_matrix:&quot;</span> <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conf_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred_model1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">BLUE</span> <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">BOLD</span> <span class="o">+</span> <span class="s2">&quot;AFTER: conf_matrix:&quot;</span> <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">conf_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----------------------------------------------------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------

<span class="ansi-blue-intense-fg ansi-bold">BEFORE: conf_matrix:</span>
--------------------
                  Pred 1              Pred 0
True   TP = 142 (33.57%)   FN = 281 (66.43%)
False    FP = 12 (0.27%)  TN = 4426 (99.73%)

<span class="ansi-blue-intense-fg ansi-bold">AFTER: conf_matrix:</span>
-------------------
                  Pred 1              Pred 0
True   TP = 136 (32.15%)   FN = 287 (67.85%)
False    FP = 12 (0.27%)  TN = 4426 (99.73%)
-----------------------------------------------------------------------
-----------------------------------------------------------------------

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compare classification report</span>
<span class="nb">print</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">YELLOW</span> <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">BOLD</span> <span class="o">+</span> <span class="s2">&quot;BEFORE: classification_report:&quot;</span> <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred_model1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">color</span><span class="o">.</span><span class="n">YELLOW</span> <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">BOLD</span> <span class="o">+</span> <span class="s2">&quot;AFTER: classification_report:&quot;</span> <span class="o">+</span> <span class="n">color</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pred2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-yellow-intense-fg ansi-bold">BEFORE: classification_report:</span>
--------------------------------
              precision    recall  f1-score   support

           0       0.94      1.00      0.97      4438
           1       0.92      0.34      0.49       423

    accuracy                           0.94      4861
   macro avg       0.93      0.67      0.73      4861
weighted avg       0.94      0.94      0.93      4861

<span class="ansi-yellow-intense-fg ansi-bold">AFTER: classification_report:</span>
--------------------------------
              precision    recall  f1-score   support

           0       0.94      1.00      0.97      4438
           1       0.92      0.32      0.48       423

    accuracy                           0.94      4861
   macro avg       0.93      0.66      0.72      4861
weighted avg       0.94      0.94      0.92      4861

</pre></div></div>
</div>
<p>As we can see, we didn’t manage to improve the performance over the test dataset after rebalancing it, but we can still check to see if we were able to improve the data balance metrics. Now we analyze the data balance analysis on the newly rebalanced data and see what the difference is from before applying SMOTE and after.</p>
<p>The feature value measures before rebalancing don’t indicate a lot of discrepancy in the outcome within specific features within a class since the values such as demographic parity which is on a 0 to 1 scale are very close to zero. After rebalancing, we still have similarly low values of these measures but there is not a significant improvement since they already started low.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feat_measures1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ClassA</th>
      <th>ClassB</th>
      <th>FeatureName</th>
      <th>dp</th>
      <th>pmi</th>
      <th>sdc</th>
      <th>ji</th>
      <th>krc</th>
      <th>llr</th>
      <th>t_test</th>
      <th>ttest_pvalue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Master's &amp; above</td>
      <td>Bachelor's</td>
      <td>education</td>
      <td>0.017814</td>
      <td>0.197252</td>
      <td>0.004788</td>
      <td>0.005594</td>
      <td>4.996442</td>
      <td>-0.622067</td>
      <td>0.262386</td>
      <td>0.408789</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Master's &amp; above</td>
      <td>Below Secondary</td>
      <td>education</td>
      <td>0.022587</td>
      <td>0.257448</td>
      <td>0.069726</td>
      <td>0.076144</td>
      <td>-27.035372</td>
      <td>3.718893</td>
      <td>-2.623174</td>
      <td>0.059886</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Bachelor's</td>
      <td>Below Secondary</td>
      <td>education</td>
      <td>0.004773</td>
      <td>0.060196</td>
      <td>0.064938</td>
      <td>0.070550</td>
      <td>-32.031814</td>
      <td>4.340960</td>
      <td>-2.885561</td>
      <td>0.051023</td>
    </tr>
    <tr>
      <th>0</th>
      <td>sourcing</td>
      <td>other</td>
      <td>recruitment_channel</td>
      <td>0.002630</td>
      <td>0.030454</td>
      <td>-0.000794</td>
      <td>-0.000925</td>
      <td>1.579734</td>
      <td>-0.240590</td>
      <td>0.085323</td>
      <td>0.469888</td>
    </tr>
    <tr>
      <th>1</th>
      <td>sourcing</td>
      <td>referred</td>
      <td>recruitment_channel</td>
      <td>-0.038804</td>
      <td>-0.366366</td>
      <td>0.048196</td>
      <td>0.053285</td>
      <td>-18.723860</td>
      <td>2.639673</td>
      <td>-1.733789</td>
      <td>0.112546</td>
    </tr>
    <tr>
      <th>2</th>
      <td>other</td>
      <td>referred</td>
      <td>recruitment_channel</td>
      <td>-0.041434</td>
      <td>-0.396820</td>
      <td>0.048990</td>
      <td>0.054210</td>
      <td>-20.303594</td>
      <td>2.880263</td>
      <td>-1.819112</td>
      <td>0.105255</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_measures</span><span class="o">.</span><span class="n">measures</span><span class="p">(</span><span class="n">smote_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ClassA</th>
      <th>ClassB</th>
      <th>FeatureName</th>
      <th>dp</th>
      <th>pmi</th>
      <th>sdc</th>
      <th>ji</th>
      <th>krc</th>
      <th>llr</th>
      <th>t_test</th>
      <th>ttest_pvalue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Bachelor's</td>
      <td>Below Secondary</td>
      <td>education</td>
      <td>0.007317</td>
      <td>0.127051</td>
      <td>0.049504</td>
      <td>0.052789</td>
      <td>-39.954385</td>
      <td>4.470495</td>
      <td>-2.572282</td>
      <td>0.061853</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Bachelor's</td>
      <td>Master's &amp; above</td>
      <td>education</td>
      <td>-0.010460</td>
      <td>-0.157473</td>
      <td>-0.003277</td>
      <td>-0.003691</td>
      <td>-5.858737</td>
      <td>0.644341</td>
      <td>-0.220763</td>
      <td>0.422882</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Below Secondary</td>
      <td>Master's &amp; above</td>
      <td>education</td>
      <td>-0.017777</td>
      <td>-0.284524</td>
      <td>-0.052781</td>
      <td>-0.056479</td>
      <td>34.095648</td>
      <td>-3.826154</td>
      <td>2.351520</td>
      <td>0.071519</td>
    </tr>
    <tr>
      <th>0</th>
      <td>other</td>
      <td>sourcing</td>
      <td>recruitment_channel</td>
      <td>0.011770</td>
      <td>0.148923</td>
      <td>0.009862</td>
      <td>0.011314</td>
      <td>0.067773</td>
      <td>0.148923</td>
      <td>0.000000</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>other</td>
      <td>referred</td>
      <td>recruitment_channel</td>
      <td>0.050002</td>
      <td>0.886267</td>
      <td>0.041898</td>
      <td>0.046479</td>
      <td>0.287918</td>
      <td>0.886267</td>
      <td>0.000000</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>sourcing</td>
      <td>referred</td>
      <td>recruitment_channel</td>
      <td>0.038232</td>
      <td>0.737344</td>
      <td>0.032036</td>
      <td>0.035165</td>
      <td>0.220145</td>
      <td>0.737344</td>
      <td>0.000000</td>
      <td>0.500000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>When we compare the distribution measures before and after rebalancing, we find that the data is much more evenly distributed (close to the uniform distribution) for the two columns of interest after rebalancing the data using the SMOTE algorithm</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># before</span>
<span class="n">dist_measures1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FeatureName</th>
      <th>kl_divergence</th>
      <th>js_dist</th>
      <th>wasserstein_dist</th>
      <th>inf_norm_dist</th>
      <th>total_variation_dist</th>
      <th>chi_sq_p_value</th>
      <th>chi_sq_stat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>education</td>
      <td>0.434946</td>
      <td>0.358906</td>
      <td>0.236105</td>
      <td>0.354158</td>
      <td>0.354158</td>
      <td>0.0</td>
      <td>30343.542312</td>
    </tr>
    <tr>
      <th>1</th>
      <td>recruitment_channel</td>
      <td>0.327144</td>
      <td>0.315774</td>
      <td>0.208248</td>
      <td>0.312371</td>
      <td>0.312371</td>
      <td>0.0</td>
      <td>20349.678919</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># after</span>
<span class="n">dist_measures</span><span class="o">.</span><span class="n">measures</span><span class="p">(</span><span class="n">smote_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>FeatureName</th>
      <th>kl_divergence</th>
      <th>js_dist</th>
      <th>wasserstein_dist</th>
      <th>inf_norm_dist</th>
      <th>total_variation_dist</th>
      <th>chi_sq_p_value</th>
      <th>chi_sq_stat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>education</td>
      <td>0.43447</td>
      <td>0.35937</td>
      <td>0.233928</td>
      <td>0.350892</td>
      <td>0.350892</td>
      <td>0.0</td>
      <td>50099.684185</td>
    </tr>
    <tr>
      <th>1</th>
      <td>recruitment_channel</td>
      <td>0.00000</td>
      <td>0.00000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.0</td>
      <td>0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The Atkinson index which gives us the overall notion of inequality before and after rebalancing shows us that in order to get a perfectly balanced dataset, we no longer need to forgo any of the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># before</span>
<span class="n">agg_measures1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>theil_l_index</th>
      <th>theil_t_index</th>
      <th>atkinson_index</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.600814</td>
      <td>0.762696</td>
      <td>0.798268</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># after</span>
<span class="n">agg_measures</span><span class="o">.</span><span class="n">measures</span><span class="p">(</span><span class="n">smote_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>theil_l_index</th>
      <th>theil_t_index</th>
      <th>atkinson_index</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.995942</td>
      <td>0.43447</td>
      <td>0.630625</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dataprocessing/case_study/case3_stat.html" class="btn btn-neutral float-left" title="Case Study 3 - Multiple Runs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../dataprocessing/intro.html" class="btn btn-neutral float-right" title="DataProcessing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Microsoft.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>