<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Decoupled Classifiers Case Study 3 &mdash; Responsible AI Mitigations  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/sg_gallery.css" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/nbsphinx-code-cells.css" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Cohort Utils" href="../../../../cohort/utils.html" />
    <link rel="prev" title="Decoupled Classifiers Case Study 2" href="case_2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            Responsible AI Mitigations
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../install_guide.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../integration_to_libs.html">How this library works with the Responsible AI Toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../api.html">API reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../../gallery.html">Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../../gallery.html#tutorials">Tutorials</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../../gallery.html#case-studies">Case Studies</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../../../gallery.html#using-the-dataprocessing-module">Using the DataProcessing Module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../gallery.html#using-the-databalanceanalysis-module">Using the DataBalanceAnalysis Module</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../../../gallery.html#using-the-cohort-module">Using the Cohort Module</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../case_1.html">Cohort Case Study 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../case_1_rebalance.html">Cohort Case Study 1 - Rebalancing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../case_1_dashboard.html">Cohort Case Study 1 - Using RAI ErrorAnalysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../case_2.html">Cohort Case Study 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../case_3.html">Cohort Case Study 3</a></li>
<li class="toctree-l4"><a class="reference internal" href="../integration_raiwidgets.html">Moving Cohorts from raimitigations to raiwidgets (and vice versa)</a></li>
<li class="toctree-l4"><a class="reference internal" href="case_1.html">Decoupled Classifiers Case Study 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="case_2.html">Decoupled Classifiers Case Study 2</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Decoupled Classifiers Case Study 3</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../dataprocessing/intro.html">DataProcessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../databalanceanalysis/intro.html">DataBalanceAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../cohort/intro.html">Cohort</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils/utils.html">Utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Responsible AI Mitigations</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../api.html">API reference</a></li>
          <li class="breadcrumb-item"><a href="../../../../cohort/cohort.html">Cohort</a></li>
          <li class="breadcrumb-item"><a href="../../../../cohort/decoupled_class.html">DecoupledClass</a></li>
      <li class="breadcrumb-item active">Decoupled Classifiers Case Study 3</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com//microsoft/responsible-ai-toolbox-mitigations/blob/main/docs/notebooks/cohort/case_study/decoupled_class/case_3.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Decoupled-Classifiers-Case-Study-3">
<h1>Decoupled Classifiers Case Study 3<a class="headerlink" href="#Decoupled-Classifiers-Case-Study-3" title="Permalink to this heading"></a></h1>
<p>This notebook will follow a similar approach to what was done in the notebook <a class="reference internal" href="case_2.html"><span class="doc">Decoupled Classifiers Case Study 2</span></a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../../../../notebooks&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">lightgbm</span> <span class="kn">import</span> <span class="n">LGBMClassifier</span>

<span class="kn">from</span> <span class="nn">raimitigations.utils</span> <span class="kn">import</span> <span class="n">split_data</span>
<span class="kn">import</span> <span class="nn">raimitigations.dataprocessing</span> <span class="k">as</span> <span class="nn">dp</span>
<span class="kn">from</span> <span class="nn">raimitigations.cohort</span> <span class="kn">import</span> <span class="n">DecoupledClass</span><span class="p">,</span> <span class="n">CohortDefinition</span><span class="p">,</span> <span class="n">CohortManager</span><span class="p">,</span> <span class="n">fetch_cohort_results</span><span class="p">,</span> <span class="n">plot_value_counts_cohort</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">download</span> <span class="kn">import</span> <span class="n">download_datasets</span>

<span class="n">SEED</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<p>Load and split the data into train and test sets:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="s1">&#39;../../../../datasets/&#39;</span>
<span class="n">download_datasets</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s1">&#39;hr_promotion/train.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;employee_id&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">label_col</span> <span class="o">=</span> <span class="s1">&#39;is_promoted&#39;</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">label_col</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>

<span class="n">df</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>department</th>
      <th>region</th>
      <th>education</th>
      <th>gender</th>
      <th>recruitment_channel</th>
      <th>no_of_trainings</th>
      <th>age</th>
      <th>previous_year_rating</th>
      <th>length_of_service</th>
      <th>KPIs_met &gt;80%</th>
      <th>awards_won?</th>
      <th>avg_training_score</th>
      <th>is_promoted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Sales &amp; Marketing</td>
      <td>region_7</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>sourcing</td>
      <td>1</td>
      <td>35</td>
      <td>5.0</td>
      <td>8</td>
      <td>1</td>
      <td>0</td>
      <td>49</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Operations</td>
      <td>region_22</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>30</td>
      <td>5.0</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Sales &amp; Marketing</td>
      <td>region_19</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>34</td>
      <td>3.0</td>
      <td>7</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Sales &amp; Marketing</td>
      <td>region_23</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>2</td>
      <td>39</td>
      <td>1.0</td>
      <td>10</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Technology</td>
      <td>region_26</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>45</td>
      <td>3.0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>73</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>54803</th>
      <td>Technology</td>
      <td>region_14</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>48</td>
      <td>3.0</td>
      <td>17</td>
      <td>0</td>
      <td>0</td>
      <td>78</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54804</th>
      <td>Operations</td>
      <td>region_27</td>
      <td>Master's &amp; above</td>
      <td>f</td>
      <td>other</td>
      <td>1</td>
      <td>37</td>
      <td>2.0</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54805</th>
      <td>Analytics</td>
      <td>region_1</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>27</td>
      <td>5.0</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>79</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54806</th>
      <td>Sales &amp; Marketing</td>
      <td>region_9</td>
      <td>NaN</td>
      <td>m</td>
      <td>sourcing</td>
      <td>1</td>
      <td>29</td>
      <td>1.0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>45</td>
      <td>0</td>
    </tr>
    <tr>
      <th>54807</th>
      <td>HR</td>
      <td>region_22</td>
      <td>Bachelor's</td>
      <td>m</td>
      <td>other</td>
      <td>1</td>
      <td>27</td>
      <td>1.0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>49</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>54808 rows × 13 columns</p>
</div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_model</span><span class="p">():</span>
    <span class="c1">#model = DecisionTreeClassifier(max_features=&quot;sqrt&quot;)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">LGBMClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="n">SEED</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
<section id="Baseline-Pipeline">
<h2>Baseline Pipeline<a class="headerlink" href="#Baseline-Pipeline" title="Permalink to this heading"></a></h2>
<p>This dataset is the same one used in the <a class="reference internal" href="../case_3.html"><span class="doc">Cohort Case Study 3</span></a> notebook, and as depicted there, the <code class="docutils literal notranslate"><span class="pre">department</span></code> column is the feature where we can identify some disparity between cohorts. Here, we’ll once again consider this feature as a sensitive feature.</p>
<p>As our first experiment, let’s create a simple pipeline for our baseline:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">BasicImputer</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">DataStandardScaler</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;encoder&quot;</span><span class="p">,</span> <span class="n">dp</span><span class="o">.</span><span class="n">EncoderOHE</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)),</span>
    <span class="p">(</span><span class="s2">&quot;estimator&quot;</span><span class="p">,</span> <span class="n">get_model</span><span class="p">())</span>
<span class="p">])</span>

<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">pred_train</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">th_dict</span> <span class="o">=</span> <span class="n">fetch_cohort_results</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">cohort_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">],</span> <span class="n">return_th_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fetch_cohort_results</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">cohort_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">],</span> <span class="n">fixed_th</span><span class="o">=</span><span class="n">th_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cohort</th>
      <th>cht_query</th>
      <th>roc</th>
      <th>precision</th>
      <th>recall</th>
      <th>f1</th>
      <th>accuracy</th>
      <th>threshold</th>
      <th>num_pos</th>
      <th>%_pos</th>
      <th>cht_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>all</td>
      <td>all</td>
      <td>0.910026</td>
      <td>0.633798</td>
      <td>0.808795</td>
      <td>0.658027</td>
      <td>0.816092</td>
      <td>0.122429</td>
      <td>3864</td>
      <td>0.234994</td>
      <td>16443</td>
    </tr>
    <tr>
      <th>1</th>
      <td>cohort_0</td>
      <td>(`department` == "Analytics")</td>
      <td>0.815071</td>
      <td>0.615072</td>
      <td>0.737173</td>
      <td>0.633686</td>
      <td>0.803662</td>
      <td>0.144258</td>
      <td>357</td>
      <td>0.225379</td>
      <td>1584</td>
    </tr>
    <tr>
      <th>2</th>
      <td>cohort_1</td>
      <td>(`department` == "Finance")</td>
      <td>0.928899</td>
      <td>0.642252</td>
      <td>0.818997</td>
      <td>0.660270</td>
      <td>0.791501</td>
      <td>0.099002</td>
      <td>210</td>
      <td>0.278884</td>
      <td>753</td>
    </tr>
    <tr>
      <th>3</th>
      <td>cohort_2</td>
      <td>(`department` == "HR")</td>
      <td>0.924777</td>
      <td>0.602336</td>
      <td>0.845885</td>
      <td>0.610867</td>
      <td>0.794034</td>
      <td>0.096400</td>
      <td>179</td>
      <td>0.254261</td>
      <td>704</td>
    </tr>
    <tr>
      <th>4</th>
      <td>cohort_3</td>
      <td>(`department` == "Legal")</td>
      <td>0.909836</td>
      <td>0.579581</td>
      <td>0.763503</td>
      <td>0.581716</td>
      <td>0.787037</td>
      <td>0.107423</td>
      <td>78</td>
      <td>0.240741</td>
      <td>324</td>
    </tr>
    <tr>
      <th>5</th>
      <td>cohort_4</td>
      <td>(`department` == "Operations")</td>
      <td>0.899921</td>
      <td>0.621445</td>
      <td>0.797078</td>
      <td>0.632185</td>
      <td>0.777155</td>
      <td>0.107618</td>
      <td>953</td>
      <td>0.281287</td>
      <td>3388</td>
    </tr>
    <tr>
      <th>6</th>
      <td>cohort_5</td>
      <td>(`department` == "Procurement")</td>
      <td>0.914249</td>
      <td>0.636048</td>
      <td>0.823387</td>
      <td>0.654546</td>
      <td>0.796365</td>
      <td>0.137644</td>
      <td>576</td>
      <td>0.268406</td>
      <td>2146</td>
    </tr>
    <tr>
      <th>7</th>
      <td>cohort_6</td>
      <td>(`department` == "R&amp;D")</td>
      <td>0.721571</td>
      <td>0.551094</td>
      <td>0.633618</td>
      <td>0.546714</td>
      <td>0.768166</td>
      <td>0.113184</td>
      <td>66</td>
      <td>0.228374</td>
      <td>289</td>
    </tr>
    <tr>
      <th>8</th>
      <td>cohort_7</td>
      <td>(`department` == "Sales &amp; Marketing")</td>
      <td>0.945638</td>
      <td>0.658135</td>
      <td>0.868133</td>
      <td>0.698209</td>
      <td>0.860826</td>
      <td>0.129820</td>
      <td>999</td>
      <td>0.193642</td>
      <td>5159</td>
    </tr>
    <tr>
      <th>9</th>
      <td>cohort_8</td>
      <td>(`department` == "Technology")</td>
      <td>0.879545</td>
      <td>0.629866</td>
      <td>0.778378</td>
      <td>0.644261</td>
      <td>0.780057</td>
      <td>0.132835</td>
      <td>582</td>
      <td>0.277672</td>
      <td>2096</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Using-the-CohortManager">
<h2>Using the CohortManager<a class="headerlink" href="#Using-the-CohortManager" title="Permalink to this heading"></a></h2>
<p>Let’s now see if we can improve our results over each cohort by building a separate pipeline for each cohort using the <code class="docutils literal notranslate"><span class="pre">CohortManager</span></code> class, similar to what we did in the <a class="reference internal" href="../case_3.html"><span class="doc">Cohort Case Study 3</span></a> notebook:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cht_manager</span> <span class="o">=</span> <span class="n">CohortManager</span><span class="p">(</span>
    <span class="n">transform_pipe</span><span class="o">=</span><span class="p">[</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">BasicImputer</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">DataStandardScaler</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">dp</span><span class="o">.</span><span class="n">EncoderOHE</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unknown_err</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
        <span class="n">get_model</span><span class="p">()</span>
    <span class="p">],</span>
    <span class="n">cohort_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">cht_manager</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">pred_cht</span> <span class="o">=</span> <span class="n">cht_manager</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="n">pred_train</span> <span class="o">=</span> <span class="n">cht_manager</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">metrics_train</span><span class="p">,</span> <span class="n">th_dict</span> <span class="o">=</span> <span class="n">fetch_cohort_results</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">cohort_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">],</span> <span class="n">return_th_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fetch_cohort_results</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">pred_cht</span><span class="p">,</span> <span class="n">cohort_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">],</span> <span class="n">fixed_th</span><span class="o">=</span><span class="n">th_dict</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cohort</th>
      <th>cht_query</th>
      <th>roc</th>
      <th>precision</th>
      <th>recall</th>
      <th>f1</th>
      <th>accuracy</th>
      <th>threshold</th>
      <th>num_pos</th>
      <th>%_pos</th>
      <th>cht_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>all</td>
      <td>all</td>
      <td>0.897907</td>
      <td>0.666922</td>
      <td>0.740960</td>
      <td>0.693698</td>
      <td>0.882807</td>
      <td>0.178975</td>
      <td>2123</td>
      <td>0.129113</td>
      <td>16443</td>
    </tr>
    <tr>
      <th>1</th>
      <td>cohort_0</td>
      <td>(`department` == "Analytics")</td>
      <td>0.801956</td>
      <td>0.610089</td>
      <td>0.668797</td>
      <td>0.628000</td>
      <td>0.839015</td>
      <td>0.169265</td>
      <td>243</td>
      <td>0.153409</td>
      <td>1584</td>
    </tr>
    <tr>
      <th>2</th>
      <td>cohort_1</td>
      <td>(`department` == "Finance")</td>
      <td>0.915831</td>
      <td>0.853684</td>
      <td>0.744484</td>
      <td>0.786259</td>
      <td>0.934927</td>
      <td>0.500199</td>
      <td>50</td>
      <td>0.066401</td>
      <td>753</td>
    </tr>
    <tr>
      <th>3</th>
      <td>cohort_2</td>
      <td>(`department` == "HR")</td>
      <td>0.894188</td>
      <td>0.788518</td>
      <td>0.682923</td>
      <td>0.721861</td>
      <td>0.948864</td>
      <td>0.420675</td>
      <td>26</td>
      <td>0.036932</td>
      <td>704</td>
    </tr>
    <tr>
      <th>4</th>
      <td>cohort_3</td>
      <td>(`department` == "Legal")</td>
      <td>0.911130</td>
      <td>0.894654</td>
      <td>0.629940</td>
      <td>0.687961</td>
      <td>0.953704</td>
      <td>0.807405</td>
      <td>6</td>
      <td>0.018519</td>
      <td>324</td>
    </tr>
    <tr>
      <th>5</th>
      <td>cohort_4</td>
      <td>(`department` == "Operations")</td>
      <td>0.894509</td>
      <td>0.666407</td>
      <td>0.751623</td>
      <td>0.695174</td>
      <td>0.872491</td>
      <td>0.162195</td>
      <td>496</td>
      <td>0.146399</td>
      <td>3388</td>
    </tr>
    <tr>
      <th>6</th>
      <td>cohort_5</td>
      <td>(`department` == "Procurement")</td>
      <td>0.898282</td>
      <td>0.674369</td>
      <td>0.738740</td>
      <td>0.698804</td>
      <td>0.881640</td>
      <td>0.223448</td>
      <td>279</td>
      <td>0.130009</td>
      <td>2146</td>
    </tr>
    <tr>
      <th>7</th>
      <td>cohort_6</td>
      <td>(`department` == "R&amp;D")</td>
      <td>0.588664</td>
      <td>0.463415</td>
      <td>0.496269</td>
      <td>0.479279</td>
      <td>0.920415</td>
      <td>0.742253</td>
      <td>2</td>
      <td>0.006920</td>
      <td>289</td>
    </tr>
    <tr>
      <th>8</th>
      <td>cohort_7</td>
      <td>(`department` == "Sales &amp; Marketing")</td>
      <td>0.938696</td>
      <td>0.670041</td>
      <td>0.787935</td>
      <td>0.707151</td>
      <td>0.893196</td>
      <td>0.165917</td>
      <td>674</td>
      <td>0.130645</td>
      <td>5159</td>
    </tr>
    <tr>
      <th>9</th>
      <td>cohort_8</td>
      <td>(`department` == "Technology")</td>
      <td>0.877133</td>
      <td>0.662127</td>
      <td>0.727013</td>
      <td>0.685259</td>
      <td>0.857824</td>
      <td>0.201117</td>
      <td>325</td>
      <td>0.155057</td>
      <td>2096</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We can see that by just training one model for each cohort based on the <code class="docutils literal notranslate"><span class="pre">department</span></code> column we can get an improvement over certain metrics.</p>
</section>
<section id="DecoupledClassifier---Transfer-Learning">
<h2>DecoupledClassifier - Transfer Learning<a class="headerlink" href="#DecoupledClassifier---Transfer-Learning" title="Permalink to this heading"></a></h2>
<p>Let’s see if we can improve the <em>“department”</em> cohorts using the <code class="docutils literal notranslate"><span class="pre">DecoupledClass</span></code>. We’ll use transfer learning, but for now we won’t use any fairness optimization.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">dp</span><span class="o">.</span><span class="n">BasicImputer</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">dp</span><span class="o">.</span><span class="n">DataMinMaxScaler</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">dp</span><span class="o">.</span><span class="n">EncoderOHE</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unknown_err</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">dec_class</span> <span class="o">=</span> <span class="n">DecoupledClass</span><span class="p">(</span>
    <span class="n">cohort_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">],</span>
    <span class="n">transform_pipe</span><span class="o">=</span><span class="n">preprocessing</span><span class="p">,</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">get_model</span><span class="p">(),</span>
    <span class="n">minority_min_rate</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span>
    <span class="n">min_cohort_pct</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">theta</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">dec_class</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">dec_class</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">fetch_cohort_results</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">cohort_def</span><span class="o">=</span><span class="n">dec_class</span><span class="p">,</span> <span class="n">fixed_th</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cohort</th>
      <th>cht_query</th>
      <th>roc</th>
      <th>precision</th>
      <th>recall</th>
      <th>f1</th>
      <th>accuracy</th>
      <th>threshold</th>
      <th>num_pos</th>
      <th>%_pos</th>
      <th>cht_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>all</td>
      <td>all</td>
      <td>0.901364</td>
      <td>0.885156</td>
      <td>0.675796</td>
      <td>0.733884</td>
      <td>0.939001</td>
      <td>0.500000</td>
      <td>607</td>
      <td>0.036915</td>
      <td>16443</td>
    </tr>
    <tr>
      <th>1</th>
      <td>cohort_0</td>
      <td>(`department` == "Analytics")</td>
      <td>0.801923</td>
      <td>0.648600</td>
      <td>0.611458</td>
      <td>0.626030</td>
      <td>0.888889</td>
      <td>0.285810</td>
      <td>108</td>
      <td>0.068182</td>
      <td>1584</td>
    </tr>
    <tr>
      <th>2</th>
      <td>cohort_1</td>
      <td>(`department` == "Finance")</td>
      <td>0.928840</td>
      <td>0.883305</td>
      <td>0.760029</td>
      <td>0.806662</td>
      <td>0.941567</td>
      <td>0.237477</td>
      <td>49</td>
      <td>0.065073</td>
      <td>753</td>
    </tr>
    <tr>
      <th>3</th>
      <td>cohort_2</td>
      <td>(`department` == "HR")</td>
      <td>0.910229</td>
      <td>0.803801</td>
      <td>0.649475</td>
      <td>0.696304</td>
      <td>0.948864</td>
      <td>0.237990</td>
      <td>20</td>
      <td>0.028409</td>
      <td>704</td>
    </tr>
    <tr>
      <th>4</th>
      <td>cohort_3</td>
      <td>(`department` == "Legal")</td>
      <td>0.917688</td>
      <td>0.733660</td>
      <td>0.722088</td>
      <td>0.727695</td>
      <td>0.941358</td>
      <td>0.227371</td>
      <td>18</td>
      <td>0.055556</td>
      <td>324</td>
    </tr>
    <tr>
      <th>5</th>
      <td>cohort_4</td>
      <td>(`department` == "Operations")</td>
      <td>0.894497</td>
      <td>0.756851</td>
      <td>0.721753</td>
      <td>0.737574</td>
      <td>0.919126</td>
      <td>0.270537</td>
      <td>262</td>
      <td>0.077332</td>
      <td>3388</td>
    </tr>
    <tr>
      <th>6</th>
      <td>cohort_5</td>
      <td>(`department` == "Procurement")</td>
      <td>0.898306</td>
      <td>0.752563</td>
      <td>0.721805</td>
      <td>0.735838</td>
      <td>0.917987</td>
      <td>0.342704</td>
      <td>169</td>
      <td>0.078751</td>
      <td>2146</td>
    </tr>
    <tr>
      <th>7</th>
      <td>cohort_6</td>
      <td>(`department` == "R&amp;D")</td>
      <td>0.699893</td>
      <td>0.545614</td>
      <td>0.541578</td>
      <td>0.543401</td>
      <td>0.882353</td>
      <td>0.226767</td>
      <td>19</td>
      <td>0.065744</td>
      <td>289</td>
    </tr>
    <tr>
      <th>8</th>
      <td>cohort_7</td>
      <td>(`department` == "Sales &amp; Marketing")</td>
      <td>0.938689</td>
      <td>0.777230</td>
      <td>0.739770</td>
      <td>0.756811</td>
      <td>0.939135</td>
      <td>0.272814</td>
      <td>319</td>
      <td>0.061834</td>
      <td>5159</td>
    </tr>
    <tr>
      <th>9</th>
      <td>cohort_8</td>
      <td>(`department` == "Technology")</td>
      <td>0.877133</td>
      <td>0.683276</td>
      <td>0.678080</td>
      <td>0.680620</td>
      <td>0.882156</td>
      <td>0.299429</td>
      <td>212</td>
      <td>0.101145</td>
      <td>2096</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="DecoupledClassifier---Transfer-Learning-+-Fairness-Optimization">
<h2>DecoupledClassifier - Transfer Learning + Fairness Optimization<a class="headerlink" href="#DecoupledClassifier---Transfer-Learning-+-Fairness-Optimization" title="Permalink to this heading"></a></h2>
<p>For our final experiment, we try adding fairness optimization in our <code class="docutils literal notranslate"><span class="pre">DecoupledClass</span></code> object. This time, we’ll optimize the Numerical Parity, which aims to make the number of positive labels for each cohort as equal as possible. We’ll set <span class="math notranslate nohighlight">\(\lambda\)</span> to a small value to give more weight to the fairness metric. This way, we expect the estimator to sacrifice a considerable amount of performance metric (precision, recall, F1, and accuracy) over fairness (equal number of positive labels).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessing</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">dp</span><span class="o">.</span><span class="n">BasicImputer</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">dp</span><span class="o">.</span><span class="n">DataMinMaxScaler</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">dp</span><span class="o">.</span><span class="n">EncoderOHE</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unknown_err</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">dec_class</span> <span class="o">=</span> <span class="n">DecoupledClass</span><span class="p">(</span>
    <span class="n">cohort_col</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;department&quot;</span><span class="p">],</span>
    <span class="n">transform_pipe</span><span class="o">=</span><span class="n">preprocessing</span><span class="p">,</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">get_model</span><span class="p">(),</span>
    <span class="n">minority_min_rate</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span>
    <span class="n">min_cohort_pct</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">theta</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span>
    <span class="n">fairness_loss</span><span class="o">=</span><span class="s2">&quot;num_parity&quot;</span><span class="p">,</span>
    <span class="n">lambda_coef</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">max_joint_loss_time</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">dec_class</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">dec_class</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">fetch_cohort_results</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">cohort_def</span><span class="o">=</span><span class="n">dec_class</span><span class="p">,</span> <span class="n">fixed_th</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cohort</th>
      <th>cht_query</th>
      <th>roc</th>
      <th>precision</th>
      <th>recall</th>
      <th>f1</th>
      <th>accuracy</th>
      <th>threshold</th>
      <th>num_pos</th>
      <th>%_pos</th>
      <th>cht_size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>all</td>
      <td>all</td>
      <td>0.901364</td>
      <td>0.885156</td>
      <td>0.675796</td>
      <td>0.733884</td>
      <td>0.939001</td>
      <td>0.500000</td>
      <td>607</td>
      <td>0.036915</td>
      <td>16443</td>
    </tr>
    <tr>
      <th>1</th>
      <td>cohort_0</td>
      <td>(`department` == "Analytics")</td>
      <td>0.801923</td>
      <td>0.659641</td>
      <td>0.613547</td>
      <td>0.630870</td>
      <td>0.892677</td>
      <td>0.295972</td>
      <td>102</td>
      <td>0.064394</td>
      <td>1584</td>
    </tr>
    <tr>
      <th>2</th>
      <td>cohort_1</td>
      <td>(`department` == "Finance")</td>
      <td>0.928840</td>
      <td>0.665214</td>
      <td>0.838909</td>
      <td>0.695979</td>
      <td>0.827357</td>
      <td>0.087748</td>
      <td>183</td>
      <td>0.243028</td>
      <td>753</td>
    </tr>
    <tr>
      <th>3</th>
      <td>cohort_2</td>
      <td>(`department` == "HR")</td>
      <td>0.910229</td>
      <td>0.591032</td>
      <td>0.830024</td>
      <td>0.585841</td>
      <td>0.764205</td>
      <td>0.064236</td>
      <td>200</td>
      <td>0.284091</td>
      <td>704</td>
    </tr>
    <tr>
      <th>4</th>
      <td>cohort_3</td>
      <td>(`department` == "Legal")</td>
      <td>0.917688</td>
      <td>0.542793</td>
      <td>0.667213</td>
      <td>0.329452</td>
      <td>0.373457</td>
      <td>0.001128</td>
      <td>222</td>
      <td>0.685185</td>
      <td>324</td>
    </tr>
    <tr>
      <th>5</th>
      <td>cohort_4</td>
      <td>(`department` == "Operations")</td>
      <td>0.894497</td>
      <td>0.881685</td>
      <td>0.701623</td>
      <td>0.757745</td>
      <td>0.938312</td>
      <td>0.436915</td>
      <td>155</td>
      <td>0.045750</td>
      <td>3388</td>
    </tr>
    <tr>
      <th>6</th>
      <td>cohort_5</td>
      <td>(`department` == "Procurement")</td>
      <td>0.898306</td>
      <td>0.807227</td>
      <td>0.719237</td>
      <td>0.753797</td>
      <td>0.930103</td>
      <td>0.402534</td>
      <td>135</td>
      <td>0.062908</td>
      <td>2146</td>
    </tr>
    <tr>
      <th>7</th>
      <td>cohort_6</td>
      <td>(`department` == "R&amp;D")</td>
      <td>0.699893</td>
      <td>0.549763</td>
      <td>0.645522</td>
      <td>0.315951</td>
      <td>0.342561</td>
      <td>0.017962</td>
      <td>211</td>
      <td>0.730104</td>
      <td>289</td>
    </tr>
    <tr>
      <th>8</th>
      <td>cohort_7</td>
      <td>(`department` == "Sales &amp; Marketing")</td>
      <td>0.938689</td>
      <td>0.956582</td>
      <td>0.707043</td>
      <td>0.778220</td>
      <td>0.956387</td>
      <td>0.611425</td>
      <td>162</td>
      <td>0.031401</td>
      <td>5159</td>
    </tr>
    <tr>
      <th>9</th>
      <td>cohort_8</td>
      <td>(`department` == "Technology")</td>
      <td>0.877133</td>
      <td>0.735181</td>
      <td>0.650417</td>
      <td>0.679839</td>
      <td>0.901240</td>
      <td>0.420690</td>
      <td>134</td>
      <td>0.063931</td>
      <td>2096</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As we can see in the previous results, there was a huge drop in the performance metric of certain cohorts in order to allow the estimator to be as fair as possible according to the Numerical Parity metric. This is an approach that must be used with care, since we should always consider the nature of the dataset, and how important is the performance and fairness. We could also try different values of <span class="math notranslate nohighlight">\(\lambda\)</span> and try to find a better balance between performance and numerical parity.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="case_2.html" class="btn btn-neutral float-left" title="Decoupled Classifiers Case Study 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../../cohort/utils.html" class="btn btn-neutral float-right" title="Cohort Utils" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Microsoft.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>