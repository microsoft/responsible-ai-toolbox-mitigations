<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Data Balance Analysis using the Adult Census Income dataset &mdash; Responsible AI Mitigations  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Python Data Balance Analysis" href="data_balance_overall.html" />
    <link rel="prev" title="Gallery" href="../../gallery.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Responsible AI Mitigations
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install_guide.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integration_to_libs.html">How this library works with the Responsible AI Toolbox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API reference</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../gallery.html">Gallery</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../../gallery.html#tutorials">Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../gallery.html#dataprocessing">DataProcessing</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../../gallery.html#databalanceanalysis">DataBalanceAnalysis</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Data Balance Analysis using the Adult Census Income dataset</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Summary​">Summary​</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Analysis:">Analysis:</a></li>
<li class="toctree-l4"><a class="reference internal" href="data_balance_overall.html">Python Data Balance Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="data_balance_overall.html#Context">Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="data_balance_overall.html#Usage">Usage</a></li>
<li class="toctree-l4"><a class="reference internal" href="data_balance_overall.html#Example-Notebook">Example Notebook</a></li>
<li class="toctree-l4"><a class="reference internal" href="data_balance_overall.html#Explanations-of-Data-Balance-Measures">Explanations of Data Balance Measures</a></li>
<li class="toctree-l4"><a class="reference internal" href="data_balance_overall.html#Mitigation">Mitigation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../gallery.html#cohort">Cohort</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../gallery.html#using-scikit-learn-s-pipeline">Using scikit-learn’s Pipeline</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../gallery.html#case-studies">Case Studies</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../databalanceanalysis/intro.html">DataBalanceAnalysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataprocessing/intro.html">DataProcessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cohort/intro.html">Cohort</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../utils/utils.html">Utils</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Responsible AI Mitigations</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../gallery.html">Gallery</a></li>
      <li class="breadcrumb-item active">Data Balance Analysis using the Adult Census Income dataset</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com//microsoft/responsible-ai-toolbox-mitigations/blob/main/docs/notebooks/databalanceanalysis/data_balance_census.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Data-Balance-Analysis-using-the-Adult-Census-Income-dataset">
<h1>Data Balance Analysis using the Adult Census Income dataset<a class="headerlink" href="#Data-Balance-Analysis-using-the-Adult-Census-Income-dataset" title="Permalink to this heading"></a></h1>
<p>In this example, we will conduct Data Balance Analysis (which consists on running three groups of measures) on the Adult Census Income dataset to determine how well features and feature values are represented in the dataset.</p>
<p>This dataset can be used to predict whether annual income exceeds $50,000/year or not based on demographic data from the 1994 U.S. Census. The dataset we’re reading contains 32,561 rows and 14 columns/features.</p>
<p><a class="reference external" href="https://archive.ics.uci.edu/ml/datasets/Adult">More info on the dataset here</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import sys
sys.path.append(&#39;../../notebooks&#39;)

import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
from download import download_datasets
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>data_dir = &quot;../../datasets/&quot;
download_datasets(data_dir)

df = pd.read_csv(data_dir + &quot;AdultCensusIncome.csv&quot;, skipinitialspace=True)

label_col = &quot;income&quot;

# convert to 0 and 1 encoding
df[label_col] = df[label_col].apply(lambda x: 0 if x == &quot;&lt;=50K&quot; else 1)
</pre></div>
</div>
</div>
<p>First we can do some preliminary EDA on the data. We will look specifically at a couple columns of interest and see the distribution of how often those feature values show up in the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df[&quot;race&quot;].value_counts().plot(kind=&quot;bar&quot;)
plt.xlabel(&quot;Race&quot;, labelpad=14)
plt.ylabel(&quot;Count&quot;, labelpad=14)
plt.title(&quot;Distribution of Race in the Data&quot;, y=1.02)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.02, &#39;Distribution of Race in the Data&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_databalanceanalysis_data_balance_census_4_1.png" src="../../_images/notebooks_databalanceanalysis_data_balance_census_4_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df[&quot;sex&quot;].value_counts().plot(kind=&quot;bar&quot;)
plt.xlabel(&quot;Sex&quot;, labelpad=14)
plt.ylabel(&quot;Count&quot;, labelpad=14)
plt.title(&quot;Distribution of Sex in the Data&quot;, y=1.02)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.02, &#39;Distribution of Sex in the Data&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_databalanceanalysis_data_balance_census_5_1.png" src="../../_images/notebooks_databalanceanalysis_data_balance_census_5_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>df[&quot;marital-status&quot;].value_counts().plot(kind=&quot;bar&quot;)
plt.xlabel(&quot;Marital Status&quot;, labelpad=14)
plt.ylabel(&quot;Count&quot;, labelpad=14)
plt.title(&quot;Distribution of Marital Status in the Data&quot;, y=1.02)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.02, &#39;Distribution of Marital Status in the Data&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_databalanceanalysis_data_balance_census_6_1.png" src="../../_images/notebooks_databalanceanalysis_data_balance_census_6_1.png" />
</div>
</div>
<p>We will now select a few columns to focus on for this analysis. In this case we will focus specifically on race and sex.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cols_of_interest = [&quot;race&quot;, &quot;sex&quot;]
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>from raimitigations.databalanceanalysis import (
    FeatureBalanceMeasure,
    AggregateBalanceMeasure,
    DistributionBalanceMeasure,
)
feature_measures = FeatureBalanceMeasure(cols_of_interest, label_col)

# drill down to race
feat_measures = feature_measures.measures(df)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>feat_measures
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ClassA</th>
      <th>ClassB</th>
      <th>FeatureName</th>
      <th>dp</th>
      <th>pmi</th>
      <th>sdc</th>
      <th>ji</th>
      <th>krc</th>
      <th>llr</th>
      <th>t_test</th>
      <th>ttest_pvalue</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>White</td>
      <td>Black</td>
      <td>race</td>
      <td>0.131980</td>
      <td>0.725320</td>
      <td>0.164302</td>
      <td>0.212784</td>
      <td>-5.412507</td>
      <td>2.911817</td>
      <td>-1.354903</td>
      <td>0.123458</td>
    </tr>
    <tr>
      <th>1</th>
      <td>White</td>
      <td>Asian-Pac-Islander</td>
      <td>race</td>
      <td>-0.009780</td>
      <td>-0.037512</td>
      <td>0.168515</td>
      <td>0.217291</td>
      <td>-8.742759</td>
      <td>3.249841</td>
      <td>-2.582092</td>
      <td>0.030596</td>
    </tr>
    <tr>
      <th>2</th>
      <td>White</td>
      <td>Amer-Indian-Eskimo</td>
      <td>race</td>
      <td>0.140104</td>
      <td>0.793149</td>
      <td>0.195180</td>
      <td>0.244934</td>
      <td>-14.433135</td>
      <td>5.286723</td>
      <td>-4.895847</td>
      <td>0.004034</td>
    </tr>
    <tr>
      <th>3</th>
      <td>White</td>
      <td>Other</td>
      <td>race</td>
      <td>0.163609</td>
      <td>1.020118</td>
      <td>0.196514</td>
      <td>0.246278</td>
      <td>-15.322864</td>
      <td>5.651366</td>
      <td>-5.256855</td>
      <td>0.003134</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Black</td>
      <td>Asian-Pac-Islander</td>
      <td>race</td>
      <td>-0.141760</td>
      <td>-0.762832</td>
      <td>0.004213</td>
      <td>0.004507</td>
      <td>-3.330252</td>
      <td>0.338024</td>
      <td>-1.227189</td>
      <td>0.143519</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Black</td>
      <td>Amer-Indian-Eskimo</td>
      <td>race</td>
      <td>0.008124</td>
      <td>0.067829</td>
      <td>0.030878</td>
      <td>0.032150</td>
      <td>-9.020628</td>
      <td>2.374906</td>
      <td>-3.540944</td>
      <td>0.011997</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Black</td>
      <td>Other</td>
      <td>race</td>
      <td>0.031629</td>
      <td>0.294798</td>
      <td>0.032212</td>
      <td>0.033494</td>
      <td>-9.910357</td>
      <td>2.739549</td>
      <td>-3.901952</td>
      <td>0.008756</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Asian-Pac-Islander</td>
      <td>Amer-Indian-Eskimo</td>
      <td>race</td>
      <td>0.149884</td>
      <td>0.830661</td>
      <td>0.026665</td>
      <td>0.027642</td>
      <td>-5.690376</td>
      <td>2.036882</td>
      <td>-2.313755</td>
      <td>0.040847</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Asian-Pac-Islander</td>
      <td>Other</td>
      <td>race</td>
      <td>0.173389</td>
      <td>1.057630</td>
      <td>0.027999</td>
      <td>0.028987</td>
      <td>-6.580105</td>
      <td>2.401525</td>
      <td>-2.674763</td>
      <td>0.027765</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Amer-Indian-Eskimo</td>
      <td>Other</td>
      <td>race</td>
      <td>0.023505</td>
      <td>0.226969</td>
      <td>0.001334</td>
      <td>0.001344</td>
      <td>-0.889729</td>
      <td>0.364643</td>
      <td>-0.361008</td>
      <td>0.368176</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Male</td>
      <td>Female</td>
      <td>sex</td>
      <td>0.196276</td>
      <td>1.027159</td>
      <td>0.161486</td>
      <td>0.222413</td>
      <td>-0.880102</td>
      <td>1.731753</td>
      <td>-0.372541</td>
      <td>0.386486</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We will visualize the demographic parities using a heat map to see which pairs of values have the biggest differences in their label values</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>races = df[&quot;race&quot;].unique()
race_dp_values = feat_measures[feat_measures[&quot;FeatureName&quot;] == &quot;race&quot;][
    [&quot;ClassA&quot;, &quot;ClassB&quot;, &quot;dp&quot;]
]
race_dp_array = np.zeros((len(races), len(races)))

for idx, row in race_dp_values.iterrows():
    class_a = row[0]
    class_b = row[1]
    dp_value = row[2]
    i, j = np.where(races == class_a)[0][0], np.where(races == class_b)
    dp_value = round(dp_value, 2)
    race_dp_array[i, j] = dp_value
    race_dp_array[j, i] = -1 * dp_value

colormap = &quot;RdBu&quot;
dp_min, dp_max = -1.0, 1.0

fig, ax = plt.subplots()
im = ax.imshow(race_dp_array, vmin=dp_min, vmax=dp_max, cmap=colormap)

cbar = ax.figure.colorbar(im, ax=ax)
cbar.ax.set_ylabel(&quot;Demographic Parity&quot;, rotation=-90, va=&quot;bottom&quot;)

ax.set_xticks(np.arange(len(races)))
ax.set_yticks(np.arange(len(races)))
ax.set_xticklabels(races)
ax.set_yticklabels(races)

plt.setp(ax.get_xticklabels(), rotation=45, ha=&quot;right&quot;, rotation_mode=&quot;anchor&quot;)

for i in range(len(races)):
    for j in range(len(races)):
        text = ax.text(j, i, race_dp_array[i, j], ha=&quot;center&quot;, va=&quot;center&quot;, color=&quot;k&quot;)

ax.set_title(&quot;Demographic Parity of Races in Adult Dataset&quot;)
fig.tight_layout()
plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_databalanceanalysis_data_balance_census_12_0.png" src="../../_images/notebooks_databalanceanalysis_data_balance_census_12_0.png" />
</div>
</div>
<p>Next we will look at the Distribution Measures, these measures allow us to compare our data to a reference distribution like the uniform distribution and are calculated based on each specified sensitive column. You don’t need the label column to calculate these measures</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dist_measures = DistributionBalanceMeasure(cols_of_interest).measures(df)

race_measures = dist_measures[dist_measures[&quot;FeatureName&quot;] == &quot;race&quot;].iloc[0]
sex_measures = dist_measures[dist_measures[&quot;FeatureName&quot;] == &quot;sex&quot;].iloc[0]
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>race_measures
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FeatureName                     race
kl_divergence               1.055793
js_dist                       0.5104
wasserstein_dist            0.261709
inf_norm_dist               0.654274
total_variation_dist        0.654274
chi_sq_p_value                   0.0
chi_sq_stat             87941.889193
Name: 0, dtype: object
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># measures_of_interest = [&quot;kl_divergence&quot;, &quot;js_dist&quot;, &quot;inf_norm_dist&quot;, &quot;total_variation_dist&quot;, &quot;wasserstein_dist&quot;]
measures_of_interest =  [
    &quot;kl_divergence&quot;,
    &quot;js_dist&quot;,
    &quot;inf_norm_dist&quot;,
    &quot;total_variation_dist&quot;,
    &quot;wasserstein_dist&quot;,
]
race_array = [round(race_measures[measure], 4) for measure in measures_of_interest]
sex_array = [round(sex_measures[measure], 4) for measure in measures_of_interest]

x = np.arange(len(measures_of_interest))
width = 0.35

fig, ax = plt.subplots()
rects1 = ax.bar(x - width / 2, race_array, width, label=&quot;Race&quot;)
rects2 = ax.bar(x + width / 2, sex_array, width, label=&quot;Sex&quot;)

ax.set_xlabel(&quot;Measure&quot;)
ax.set_ylabel(&quot;Value&quot;)
ax.set_title(&quot;Distribution Balance Measures of Sex and Race in Adult Dataset&quot;)
ax.set_xticks(x)
ax.set_xticklabels(measures_of_interest)
ax.legend()

plt.setp(ax.get_xticklabels(), rotation=20, ha=&quot;right&quot;, rotation_mode=&quot;default&quot;)


def autolabel(rects):
    for rect in rects:
        height = rect.get_height()
        ax.annotate(
            &quot;{}&quot;.format(height),
            xy=(rect.get_x() + rect.get_width() / 2, height),
            xytext=(0, 1),  # 1 point vertical offset
            textcoords=&quot;offset points&quot;,
            ha=&quot;center&quot;,
            va=&quot;bottom&quot;,
        )


autolabel(rects1)
autolabel(rects2)

fig.tight_layout()

plt.show()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/notebooks_databalanceanalysis_data_balance_census_16_0.png" src="../../_images/notebooks_databalanceanalysis_data_balance_census_16_0.png" />
</div>
</div>
<p>Interpret Distribution Balance Measures​ Race has a JS Distance of 0.5104 while Sex has a JS Distance of 0.1217.</p>
<p>Knowing that JS Distance is between [0, 1] where 0 means perfectly balanced distribution, we can tell that:</p>
<p>There is a larger disparity between various races than various sexes in our dataset. Race is nowhere close to a perfectly balanced distribution (i.e. some races are seen ALOT more than others in our dataset). Sex is fairly close to a perfectly balanced distribution.</p>
<p>Calculate Aggregate Balance Measures​ Aggregate Balance Measures allow us to obtain a higher notion of inequality. They are calculated on the global set of sensitive columns and don’t use the label column.</p>
<p>These measures look at distribution of records across all combinations of sensitive columns. For example, if Sex and Race are sensitive columns, it shall try to quantify imbalance across all combinations - (Male, Black), (Female, White), (Male, Asian-Pac-Islander), etc.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>agg_measures = AggregateBalanceMeasure(cols_of_interest)
agg_measures.measures(df)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>theil_l_index</th>
      <th>theil_t_index</th>
      <th>atkinson_index</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.50467</td>
      <td>1.120823</td>
      <td>0.777909</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Summary​">
<h1>Summary​<a class="headerlink" href="#Summary​" title="Permalink to this heading"></a></h1>
<p>Throughout the course of this sample notebook, we have:</p>
<ul class="simple">
<li><p>Chosen “Race” and “Sex” as columns of interest in the Adult Census Income dataset.</p></li>
<li><p>Done preliminary analysis on our dataset.</p></li>
<li><p>Ran the 3 groups of measures that compose our Data Balance</p></li>
</ul>
</section>
<section id="Analysis:">
<h1>Analysis:<a class="headerlink" href="#Analysis:" title="Permalink to this heading"></a></h1>
<ul>
<li><p class="rubric" id="feature-balance-measures">Feature Balance Measures</p>
<ul class="simple">
<li><p>Calculated Feature Balance Measures to see that the highest Demographic Parity is in “Sex”: Males see &gt;50k income much more than Females.</p></li>
<li><p>Visualized Demographic Parity of Races to see that Asian-Pac-Islander sees &gt;50k income much more than Other, in addition to other race combinations.</p></li>
</ul>
</li>
<li><p class="rubric" id="distribution-balance-measures">Distribution Balance Measures</p>
<ul class="simple">
<li><p>Calculated Distribution Balance Measures to see that “Sex” is much closer to a perfectly balanced distribution than “Race”.</p></li>
</ul>
</li>
</ul>
<p>Visualized various distribution balance measures to compare their values for “Race” and “Sex”.</p>
<ul>
<li><p class="rubric" id="aggregate-balance-measures">Aggregate Balance Measures</p>
<ul class="simple">
<li><p>Calculated Aggregate Balance Measures to see that we need to forego 77.79% of data points to have a perfectly balanced dataset. We identified that our dataset is leaning towards maximum inequality, and we should take actionable steps to:</p></li>
<li><p>Upsample data points where the feature value is barely observed.</p></li>
<li><p>Downsample data points where the feature value is observed much more than others.</p></li>
</ul>
</li>
</ul>
<section id="In-conclusion:">
<h2>In conclusion:<a class="headerlink" href="#In-conclusion:" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p>These measures provide an indicator of disparity on the data, allowing for users to explore potential mitigations before proceeding to train.</p></li>
<li><p>Users can use these measures to set thresholds on their level of “tolerance” for data representation. Production pipelines can use these measures as baseline for models that require frequent retraining on new data.</p></li>
<li><p>These measures can also be saved as key metadata for the model/service built and added as part of model cards or transparency notes helping drive overall accountability for the ML service built and its performance across different demographics or sensitive attributes.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../../gallery.html" class="btn btn-neutral float-left" title="Gallery" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="data_balance_overall.html" class="btn btn-neutral float-right" title="Python Data Balance Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Microsoft.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>